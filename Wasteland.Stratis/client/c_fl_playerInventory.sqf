/*
	ArmA 3 Wasteland
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	
	Special build for Dwarden
	
	ESABQIEXHTFRGOFR
*/
#include "hpp\idcs.hpp"
#include "hpp\settings.hpp"
wg4v6u={createDialog "Wasteland_PlayerMenu";wgr9lg=-1;private["_0nm","_0gn","_0fg","_0js","_0is"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNil{_0nm})exitWith{systemChat "Error: Failed to open Player Menu, display is nil";};if(isNull(_0nm))exitWith{systemChat "Error: Failed to open Player Menu, display is null";};[_0nm,""]call bis_fnc_guiEffectTiles;(_0nm displayCtrl wg26bx)ctrlShow false;(_0nm displayCtrl wg2h2b)ctrlShow false;(_0nm displayCtrl wg393u)ctrlSetText(localize "STR_WL_Dlg_PlayerMenu_NothingSelected");(_0nm displayCtrl wgsujt)ctrlSetStructuredText(parseText "");(_0nm displayCtrl wgt9k1)ctrlSetText wg4sje;(_0nm displayCtrl wgt9k1)ctrlShow!isStreamFriendlyUIEnabled;call wgmp1t;call wgukwq;call wgl5ea;call wgirv4;_0is=-1;for "_i" from 0 to 3 do{_0fg=wgt7bi select _i;if(count(_0fg)==2)then{if(_0is==-1)then{_0is=_i};_0js=_0fg call wgxe7d;(_0nm displayCtrl(wg1riz+_i))ctrlSetText(_0js select 0);};};if(_0is!=-1)then{_0is call wgyfr1;};{if((_x select 2)!="")then{private["_0ks","_0do"];if((_x select 0)!=wgepav)then{_0ks=getNumber(configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>(_x select 2)>>"ItemInfo">>"containerclass")>>"maximumload");_0do=getText(configFile>>"CfgWeapons">>(_x select 2)>>"picture");}else{_0ks=getNumber(configFile>>"CfgVehicles">>(_x select 2)>>"maximumload");_0do=getText(configFile>>"CfgVehicles">>(_x select 2)>>"picture");};(_0nm displayCtrl(_x select 0))ctrlSetText _0do;(_0nm displayCtrl(_x select 1))ctrlSetText format["%1/%2",round((_x select 3)*_0ks),_0ks,floor((_x select 3)*100),"%"];}else{(_0nm displayCtrl(_x select 1))ctrlSetText(localize "STR_WL_Dlg_PlayerMenu_CapacityNone");};}forEach[[wgkw4c,wgrxzg,uniform player,loadUniform player],[wgkj6r,wg6jr3,vest player,loadVest player],[wgepav,wguksy,backpack player,loadBackpack player]];true spawn wgmuqg;};wgu2to={if(isNull(uiNamespace getVariable["Wasteland_PlayerMenu",displayNull])&&(alive player)&&!wggw5j&&!wg14a5)then{call wg4v6u;};};wgirv4={private["_0jk","_0gn","_05d"];disableSerialization;_0jk=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNil{if(isNull(_0jk))then{nil}else{true}})exitWith{};_0gn=_0jk displayCtrl wgc6bn;_05d="";for "_i" from 0 to count(wgr77l)-1 do{_05d=format["%1%2<br/>",_05d,(if(_i==3)then{format["$%1",wgr77l select _i];}else{wgr77l select _i})];};_0gn ctrlSetStructuredText parseText _05d;};wgmuqg={private["_0nm","_0ls","_05m","_0en","_uptimepos"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};_05m=_0nm displayCtrl wgqz17;_0ls=_0nm displayCtrl wggjyj;_0ms=_0nm displayCtrl wgyon7;while{!isNull(_0nm)}do{_0ls ctrlSetText(if(isNil{wgiztd})then{"???"}else{((serverTime-wgjnzt)call wgc61g)});_0ms ctrlSetText(if(isNil{wgfrje})then{"???"}else{if(diag_tickTime>wgfrje)then{"Next restart"}else{(wgfrje-diag_tickTime)call wgc61g}});sleep 0.1;};};wg2j5b={if!(_this in[0,1])exitWith{};if!(wgr9lg in[0,1,2,3])exitWith{};private["_0nm","_0js"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};_0js=(wgt7bi select wgr9lg)call wgxe7d;switch(_this)do{case 0:{if(typeName(_0js select 3)==typeName(false))then{if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotDropInVehicle";};wgr9lg call wgbdb2;}else{wgr9lg call wgzp2u;};};case 1:{if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotDropInVehicle";};wgr9lg call wgbdb2;};};};wgyfr1={private["_0nm","_0js","_0ns"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};if(wgr9lg!=-1)then{(_0nm displayCtrl(wg1riz+wgr9lg))ctrlSetTextColor[1,1,1,0.5];(_0nm displayCtrl(wgsi3m+wgr9lg))ctrlSetBackgroundColor[0,0,0,0.7];};wgr9lg=_this;if(_this in[0,1,2,3])then{_0js=(wgt7bi select _this)call wgxe7d;(_0nm displayCtrl(wg1riz+_this))ctrlSetTextColor[1,1,1,1];(_0nm displayCtrl(wgsi3m+_this))ctrlSetBackgroundColor[1,1,1,0.7];(_0nm displayCtrl(wg393u))ctrlSetText(_0js select 1);(_0nm displayCtrl(wgsujt))ctrlSetStructuredText parseText(_0js select 2);(_0nm displayCtrl wg26bx)ctrlShow false;(_0nm displayCtrl wg2h2b)ctrlShow false;_0ns=wg2h2b;if(typeName(_0js select 3)==typeName(false))then{_0ns=wg26bx;}else{(_0nm displayCtrl wg26bx)ctrlShow true;(_0nm displayCtrl wg26bx)ctrlSetText(_0js select 3);};(_0nm displayCtrl _0ns)ctrlShow true;(_0nm displayCtrl _0ns)ctrlSetText(localize "STR_WL_Dlg_PlayerMenu_ButtonDrop");}else{(_0nm displayCtrl wg26bx)ctrlShow false;(_0nm displayCtrl wg2h2b)ctrlShow false;(_0nm displayCtrl wg393u)ctrlSetText(localize "STR_WL_Dlg_PlayerMenu_NothingSelected");(_0nm displayCtrl wgsujt)ctrlSetStructuredText(parseText "");};};wg7ww1={private["_0nm","_0js","_0ns"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};if(count(wgt7bi select _this)==2)then{_0js=(wgt7bi select _this)call wgxe7d;(_0nm displayCtrl(wg1riz+_this))ctrlSetText(_0js select 0);}else{(_0nm displayCtrl(wg1riz+_this))ctrlSetText "";};(_0nm displayCtrl(wg1riz+_this))ctrlSetTextColor[1,1,1,0.5];(_0nm displayCtrl(wgsi3m+_this))ctrlSetBackgroundColor[0,0,0,0.7];};wgmp1t={private["_0nm"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNil{if(isNull(_0nm))then{nil}else{true}})exitWith{};_i=0;{if(_x>0)then{_x=0.1+(_x*0.9)};(_0nm displayCtrl(wgrnch+_i))ctrlSetBackgroundColor[_x,0,0,1];_i=_i+1;}forEach[damage player,player getHitPointDamage "HitHead",player getHitPointDamage "HitBody",player getHitPointDamage "HitHands",player getHitPointDamage "HitLegs"];};wgocyz={private["_0nm","_0gn","_0xq","_0d"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNil{if(isNull(_0nm))then{nil}else{true}})exitWith{};_0xq=[0,0.5,0,1];_0d=0.5;if(typeName(_this)==typeName([]))then{if(count(_this)==2)then{_0xq=_this select 0;_0d=_this select 1;};};_0gn=(_0nm displayCtrl wg2177);_0gn ctrlSetBackgroundColor _0xq;_0gn ctrlCommit _0d;waitUntil{ctrlCommitted _0gn};_0gn ctrlSetBackgroundColor[0,0,0,1];};wgukwq={private["_0nm"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{};(_0nm displayCtrl wggigj)ctrlSetText format["$%1",wg1id4];};wgl5ea={private["_0nm","_0e","_0gn"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};_0gn=(_0nm displayCtrl wg2pwk);lbClear _0gn;if(wg1id4>0)then{_0e=_0gn lbAdd format["$%1",wg1id4];_0gn lbSetValue[_0e,wg1id4];{if(wg1id4>=_x)then{_0e=_0gn lbAdd format["$%1",_x];_0gn lbSetValue[_0e,_x];};}forEach wgkgku;};};wgyjir={private["_0nm","_0gn"];disableSerialization;_0nm=uiNamespace getVariable "Wasteland_PlayerMenu";if(isNull(_0nm))exitWith{systemChat "Error: Player menu is no longer open";};if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotDropInVehicle";};_0gn=(_0nm displayCtrl wg2pwk);if((lbCurSel _0gn!=-1))then{(_0gn lbValue(lbCurSel _0gn))call wgu2ma;};};
#define wgqnmo 0
#define wg7hwq 1
#define wgkg8t 2
#define wgfaw6 3
"wgw4e9" addPublicVariableEventHandler{_01e=_this select 1 select 0;_0qa=_this select 1 select 1;_0gj=_this select 1 select 2;_0hj=_this select 1 select 3;if(_01e getVariable["inventory_key",""]==_0qa)then{switch(_0gj)do{case wgqnmo:{_0hj call wg194b};case wg7hwq:{_0hj call wgr5k2};case wgkg8t:{};case wgfaw6:{};};}else{hint localize "STR_WL_Dlg_PlayerMenu_MessageSackDesync";};};"wgdlh6" addPublicVariableEventHandler{_0ab=_this select 1 select 0;_0hj=_this select 1 select 1;if(!isNull(_0ab))then{[_0ab,_0hj]call wgay66;};};wgu2ma={if(_this<0)exitWith{};if(wg1id4<_this)exitWith{hint format["You don't have $%1 to drop",_this];};private["_01e","_0os"];_01e=call wgs4f1;_0os=isNull(_01e);if(_0os)then{_01e=call wgz71k;};if(_0os||(([_01e,10]call wgvdho)<=1&&false))then{[_01e,_this]call wgj1kw;}else{wgwu93=[player,_01e,_01e getVariable["inventory_key",""],wgqnmo,[_01e,_this]];publicVariableServer "wgwu93";};};wg194b={private["_01e","_0ps"];_01e=_this select 0;_0ps=_this select 1;if(isNull(_01e))exitWith{};_this call wgj1kw;};wgj1kw={private["_01e","_0ps","_0qs"];_01e=_this select 0;_0ps=_this select 1;_0qs=(_01e getVariable["inventory_money",0])+_0ps;_01e setVariable["inventory_money",_0qs,true];_01e setVariable["inventory_key",call wg2ien,true];wg1id4=wg1id4-_0ps;call wgukwq;call wgl5ea;player playAction "PutDown";};wgs4f1={private["_0zp","_01e","_0rs","_pos","_0hf","_0if"];_0zp=[];_0hf=getPosASL player;_0hf set[2,(_0hf select 2)+0.8];{_0if=getPosASL _x;_0if set[2,(_0hf select 2)+0.8];if(!lineIntersects[_0hf,_0if,_x,player])then{_0zp set[count _0zp,_x]};}forEach nearestObjects[player,["Land_Sack_F"],wgnxma];_0rs=false;_01e=objNull;if(count(_0zp)>0)then{if(cursorTarget in _0zp)then{_01e=cursorTarget;_0rs=true;}else{_01e=_0zp select 0;{if([position player,getdir player,100-20*(3-(((player distance _x)max 1)min 3))/2,position _x]call BIS_fnc_inAngleSector)exitWith{_01e=_x;_0rs=true;};}forEach _0zp;};};if(!isNull(_01e))then{if(!_0rs)then{_pos=getPosATL player;_pos set[0,(_pos select 0)+(sin getDir player)];_pos set[1,(_pos select 1)+(cos getDir player)];_01e setPosATL _pos;};player reveal[_01e,4];};_01e};wgz71k={private["_01e","_pos"];_pos=getPosATL player;_pos set[0,(_pos select 0)+(sin getDir player)];_pos set[1,(_pos select 1)+(cos getDir player)];_01e=createVehicle["Land_Sack_F",getPosATL player,[],0,"CAN_COLLIDE"];_01e setPosATL _pos;_01e setVariable["inventory_key",call wg2ien,true];[_01e,false]call wgthvn;call wgx46y;[_01e,false]call wg1bsw;call wglxj9;_01e};wg2jpq={if((_this getVariable["try_pickup_money_time",0])+1>serverTime)exitWith{};private "_0ho";_0ho=_this getVariable["revive_body",objNull]getVariable["revive_player",objNull];if(switch(true)do{case(!alive _0ho):{false};case(side group _0ho==independent):{false};case(side group _0ho!=side group player):{false};case(group player==group _0ho):{false};default{true};})exitWith{hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2",localize "STR_WL_Gen_Warning",localize "STR_WL_Acts_CannotLootDeadFriendly"];};wgwu93=[player,_this,_this getVariable["inventory_key",""],wg7hwq,_this];publicVariableServer "wgwu93";if(!isNil{wgiztd})then{_this setVariable["try_pickup_money_time",serverTime];};};wgr5k2={if(isNull(_this))exitWith{};_this call wgpngw;};wgpngw={private["_0ss","_08n"];_0ss=_this getVariable["inventory_money",0];if(_0ss>0)then{wg1id4=wg1id4+_0ss;if(count(_this getVariable["inventory",[]])==0)then{deleteVehicle _this;}else{_this setVariable["inventory_money",0,true];_this setVariable["inventory_key",call wg2ien,true];};if(_0ss>500)then{wgoy2p=[wgk94m,player,_0ss];publicVariable "wgoy2p";};_08n="money" call wgxe7d;hint parseText format["%4 <t color='#aaffaa'>$%1</t><br/><br/>%5<br/><img image='%2' size='2'/> <t color='#aaffaa'size='1.5'>$%3</t>",_0ss,_08n select 0,wg1id4,localize "STR_WL_Dlg_PlayerMenu_MessageYouHaveTaken",localize "STR_WL_Dlg_PlayerMenu_MessageTotalMoney"];player playAction "PutDown";};};wg6fll={_this call wg2qda};wg2qda={_0ts=call wguyct;if(_0ts==-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageInventoryIsFull";false};private["_0i","_0fg","_0ha"];_0i=false;_0ha="";switch(typeOf _this)do{case "Land_Sacks_goods_F":{_0fg=["food",[]];_0ha="food_count";};case "Land_BarrelWater_F":{_0fg=["water",[]];_0ha="water_count";};};if(_this getVariable[_0ha,0]>0)then{_0ka=_this getVariable[_0ha,0];[_0fg,_0ts]call wgib3x;if(_0ka>1)then{_this setVariable[_0ha,_0ka-1,true];}else{deleteVehicle _this;};_0fg call wgphx6;_0i=true;player playAction "PutDown";};_0i};wgs9u5={_this call wgom4q};wgom4q={private["_01e","_0us","_0fg","_0ts","_0e"];_0ts=call wguyct;if(_0ts==-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageInventoryIsFull";false};_01e=_this select 0;_0fg=_this select 1;if(isNull(_01e))exitWith{false};_0us=_01e getVariable["inventory",[]];_0e=[_0us,_0fg]call wgeuz8;if(_0e==-1)exitWith{false};[_0us select _0e,_0ts]call wgib3x;_0us=[_0us,_0e]call wgi28b;if(count(_0us)==0&&!(_01e getVariable["inventory_money",0]>0))then{deleteVehicle _01e;}else{_01e setVariable["inventory",_0us,true];_01e setVariable["inventory_key",call wg2ien,true];};(wgt7bi select _0ts)call wgphx6;player playAction "PutDown";true};wglxs7={private["_name","_0vs","_0js","_0ws","_0fg"];_name=_this select 0;_0vs=_this select 1;if(call wguyct==-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageInventoryIsFull";false};_0js=[_name,_0vs]call wgxe7d;_0fg=objNull;{_0ws=_x getVariable["inventory_stuff",[]];if((count(_0vs)==0)&&(count(_0ws)==0))then{_0fg=_x;}else{if(count(_0vs)==count(_0ws))then{if(_0vs select 0==_0ws select 0)then{_0fg=_x;};};};if(!isNull(_0fg))exitWith{};}forEach nearestObjects[player,[_0js select 4],wgvjcy];if(isNull(_0fg))exitWith{false};if((([_0fg,10]call wgvdho)<=1&&false)||local _0fg)then{[_0fg,_this]call wgay66;}else{wgw2yi=[player,_0fg,_this];publicVariableServer "wgw2yi";};};wgay66={private["_name","_0vs","_0ws","_0fg","_0ts"];_0fg=_this select 0;_name=_this select 1 select 0;_0vs=_this select 1 select 1;_0ws=_0fg getVariable["inventory_stuff",[]];if(isNull(_0fg))exitWith{false};_0ts=call wguyct;if(_0ts==-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageInventoryIsFull";false};[[_name,_0ws],_0ts]call wgib3x;deleteVehicle _0fg;[_name,_0ws]call wgphx6;player playAction "PutDown";true};wghy5b={if(wg6z48)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageBusy";};private["_0e"];_0e=([wgt7bi,["fuelcan",["empty"]]]call wgeuz8);if(_0e==-1)exitWith{};[localize "STR_WL_Dlg_PlayerMenu_ActionFillFuelcan",localize "STR_WL_Dlg_PlayerMenu_ActionFillFuelcanDone",10,_0e,{(count(wgt7bi select _this)==0)||(diag_tickTime-1<wg95zb)},{},{[["fuelcan",[]],_this]call wglypc;}]spawn wg4o62;};wgx4to={if(wg6z48)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageBusy";false};private "_0ts";_0ts=call wguyct;if(_0ts==-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageInventoryIsFull";false};[["repairkit",[]],_0ts]call wgib3x;["repairkit",[]]call wgphx6;player playAction "PutDown";true};wgkm81={if(wg6z48)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageBusy";};if({alive _x}count(_this getVariable["R3F_LOG_objets_charges",[]])>0)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCantSalvageVehicleContents";};if({alive(_x getVariable["revive_player",objNull])&&(((_x getVariable["revive_side",civilian]==playerSide)&&(playerSide!=independent))||(_x getVariable["revive_group",grpNull]==group player))}count(crew _this)>0)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCantSalvageRevivablePlayers";};private["_0fd","_0g","_name","_0h","_0xk","_0d"];_0fd=_this;_0g=boundingBox _this;_name=getText(configFile>>"CfgVehicles">>typeOf _0fd>>"displayname");_0h=ceil((_0g select 1 select 0)-(_0g select 0 select 0)+(_0g select 1 select 1)-(_0g select 0 select 1));_0xk=_0h*30;_0d=(if(([wgt7bi,["repairkit",[]]]call wgeuz8)<0)then{_0h*2}else{ceil(_0h/2)})max 5;[format["%1 ""%2""",localize "STR_WL_Dlg_PlayerMenu_ActionSalvage",_name],format[localize "STR_WL_Dlg_PlayerMenu_ActionSalvageDone",_name,_0xk],_0d,[_0fd,_0xk],{isNull(_this select 0)||(diag_tickTime-1<wg95zb)},{},{wg1id4=wg1id4+(_this select 1);call wgukwq;wgf3sx=_this select 0;publicVariableServer "wgf3sx";}]spawn wg4o62;};wg4rtn={if(isNull(attachedTo _this)&&vehicle player==player)then{if(!isNull(wgcnta))then{call wguxaj;};wgcnta=_this;wgcnta attachTo[player,[-0.05,0,0.01],"LeftForeArm"];if(wgcnta isKindOf "TimeBombCore")then{wgcnta setDir 120;};player playAction "PutDown";};};wguxaj={if(!isNull(wgcnta))then{private["_pos"];detach wgcnta;_pos=getPosASL wgcnta;_pos=_pos call wge6h2;wgcnta setPosASL _pos;if((local wgcnta)&&(_pos select 2)<0.1)then{wgcnta setVectorUp(surfaceNormal getPosWorld(wgcnta));}else{wgcnta setDir(random 360);};wgcnta=objNull;};};wgzp2u={if(wg6z48)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageBusy";};if(_0fg select 0 in["food","water"]&&(getPosASLW player)select 2<-1)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotUseInWater";};private["_0fg"];_0fg=(wgt7bi select _this);switch(_0fg select 0)do{case "food":{[localize "STR_WL_Dlg_PlayerMenu_ActionEatFood",localize "STR_WL_Dlg_PlayerMenu_ActionEatFoodDone",8,_this,{(count(wgt7bi select _this)==0)||(diag_tickTime-1<wg95zb)},{},{_0xs=wgwsvk;wgwsvk=(wgwsvk+30)min 100;_this call wgbyq8;call wgychn;call wgmp1t;call wgmw2n;if(wgwsvk>_0xs)then{wg4jqm=[player,wgwsvk-_0xs];publicVariableServer "wg4jqm";};}]spawn wg4o62;};case "water":{[localize "STR_WL_Dlg_PlayerMenu_ActionDrinkWater",localize "STR_WL_Dlg_PlayerMenu_ActionDrinkWaterDone",6,_this,{(count(wgt7bi select _this)==0)||(diag_tickTime-1<wg95zb)},{},{_0ys=wgsna4;wgsna4=(wgsna4+50)min 100;_this call wgbyq8;call wgychn;call wgmp1t;call wgmw2n;if(wgsna4>_0ys)then{wg4jqm=[player,wgsna4-_0ys];publicVariableServer "wg4jqm";};}]spawn wg4o62;};case "repairkit":{if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotRepairInVehicle"};
#define wgqt2l		"Land_DieselGroundPowerUnit_01_F"
private["_0ca","_0zs","_01s"];_0ca=objNull;{_0zs=false;_01s=false;_02s=_x;{if(!isNil{_02s getHitPointDamage _x}&&(_02s getHitPointDamage _x>0.85))exitWith{_01s=true;};}forEach["HitLFWheel","HitLBWheel","HitLF2Wheel","HitRFWheel","HitRBWheel","HitRF2Wheel"];{if(!isNil{_02s getHitPointDamage _x}&&(_02s getHitPointDamage _x>0.4))exitWith{_0zs=true;};}forEach["HitHRotor","HitVRotor"];if(alive _x&&(!(canMove _02s)||_0zs||_01s||(damage _02s)>0.1||((count crew _02s>0)&&(count(configFile>>"CfgVehicles">>typeOf _02s>>"Turrets")>0)&&!(canFire _02s)))||((typeOf _x==wgqt2l)&&(damage _x>=0.5)))exitWith{_0ca=_02s;};}forEach nearestObjects[player,["LandVehicle","Air","Ship",wgqt2l],6];if(isNull(_0ca))exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageNothingToRepair"};_name=(if(typeOf _0ca==wgqt2l)then{format[localize "STR_WL_Acts_RadarName",_0ca call wg9ci4]}else{getText(configFile>>"CfgVehicles">>typeOf _0ca>>"displayName")});[format["%1 ""%2""",localize "STR_WL_Dlg_PlayerMenu_ActionRepair",_name],localize "STR_WL_Dlg_PlayerMenu_ActionRepairDone",(typeOf _0ca)call wgm44g,[_this,_0ca,getPosATL _0ca],{(getPosATL(_this select 1)distance(_this select 2)>1)||count(wgt7bi select(_this select 0))==0||(diag_tickTime-1<wg95zb)},{},{_0fd=(_this select 1);_0fd setDamage 0;if(typeOf _0fd==wgqt2l)then{if(_0fd getVariable["object_locked",false])then{if(_0fd call wgbu3w)then{_0fd setVariable["object_locked",false,true];};};};(_this select 0)call wgbyq8;}]spawn wg4o62;};case "fuelcan":{if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotRefuelInVehicle"};private["_0ca"];_0ca=objNull;{if(alive _x&&fuel _x<0.95)exitWith{_0ca=_x;};}forEach nearestObjects[player,["LandVehicle","Air","Ship"],6];if(isNull(_0ca))exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageNothingToRefuel"};[format["%1 ""%2""",localize "STR_WL_Dlg_PlayerMenu_ActionRefuel",getText(configFile>>"CfgVehicles">>typeOf _0ca>>"displayName")],{format["%1 %2%3",localize "STR_WL_Dlg_PlayerMenu_ActionRefuelDone",ceil((fuel(_this select 1)+(_this select 3))*100)min 100,"%"]},10,[_this,_0ca,getPosATL _0ca,(typeOf _0ca)call wgugd5],{(getPosATL(_this select 1)distance(_this select 2)>1)||count(wgt7bi select(_this select 0))==0||(diag_tickTime-1<wg95zb)},{},{wg6tyw=[(_this select 1),fuel(_this select 1)+(_this select 3)];publicVariable "wg6tyw";(_this select 1)setFuel(fuel(_this select 1)+(_this select 3));[["fuelcan",["empty"]],(_this select 0)]call wglypc;}]spawn wg4o62;};case "vehammo":{if(vehicle player!=player)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotRearmInVehicle"};private["_0ca","_03s"];_0ca=objNull;_03s=false;{if(alive _x&&((_x call wgleln)||_x isKindOf "Plane"))exitWith{_0ca=_x;};}forEach nearestObjects[player,["LandVehicle","Air","Ship","StaticWeapon"],8];if(isNull(_0ca))exitWith{if(_03s)then{hint localize "STR_WL_Dlg_PlayerMenu_MessageCannotRearmWithCrew";}else{hint localize "STR_WL_Dlg_PlayerMenu_MessageNothingToRearm";};};wgszzz=[player,_0ca];publicVariableServer "wgszzz";[format["%1 ""%2""",localize "STR_WL_Dlg_PlayerMenu_ActionRearm",getText(configFile>>"CfgVehicles">>typeOf _0ca>>"displayName")],{localize "STR_WL_Dlg_PlayerMenu_ActionRearmDone"},50,[_this,_0ca,getPosATL _0ca],{({alive _x}count(crew(_this select 1))>0)||(getPosATL(_this select 1)distance(_this select 2)>1)||count(wgt7bi select(_this select 0))==0||(diag_tickTime-1<wg95zb)},{},{if(!local(_this select 1))then{wgq888=[(_this select 1),1];publicVariable "wgq888";}else{(_this select 1)setVehicleAmmo 1;};(_this select 0)call wgbyq8;}]spawn wg4o62;};};};wgugd5={private["_0i"];_0i=0.5;{if(_this isKindOf(_x select 0))exitWith{_0i=_x select 1};}forEach wg6wg6;_0i};wg6wg6=[["UAV_01_base_F",1],["Air",0.3],["Wheeled_APC_F",0.3],["Tank",0.3],["Quadbike_01_base_F",0.9]];wgm44g={private["_0i"];_0i=10;{if(_this isKindOf(_x select 0))exitWith{_0i=_x select 1};}forEach wg9r8c;_0i};wg9r8c=[["Tank",60],["Wheeled_APC_F",60],["MRAP_01_base_F",20],["MRAP_02_base_F",20],["MRAP_03_base_F",20],["Quadbike_01_base_F",8],["Car",10],["Heli_Light_01_base_F",20],["Heli_Light_02_base_F",40],["Air",60],["SDV_01_base_F",20],["Boat_Armed_01_base_F",15],["Ship",10]];wge6h2={private["_04s","_05s","_06s","_05j"];_04s=_this;_05s=+_04s;_06s=100;for "_i" from 1 to 5 do{_05s set[2,_04s select 2];for "_j" from 1 to 100 do{_05s set[2,(_05s select 2)-_06s];if((_04s select 2)<0)exitWith{_04s set[2,0];_i=5;};if(terrainIntersectASL[_04s,_05s])exitWith{};if(count(lineIntersectsObjs[_04s,_05s,objNull,player,false,4])>0)exitWith{};_04s=+_05s;};_06s=_06s/10;};_05j=getTerrainHeightASL _04s;if(_04s select 2<_05j)then{_04s set[2,_05j]};_04s};wg3ef8={private["_07s","_05a","_09a","_08h"];_08h=_this;_07s=[];_05a=random 360;_09a=[];{if(count(_x)!=0)then{_0js=_x call wgxe7d;_06r=2+random 0.5;_05a=_05a+45;if(typeName(_0js select 4)==typeName(false))then{_07s=[_07s,[_x]]call wgui9y;}else{private["_0ab","_pos"];_pos=(getPosASL _08h);_pos set[0,(_pos select 0)+(sin _05a)*_06r];_pos set[1,(_pos select 1)+(cos _05a)*_06r];_pos set[2,(_pos select 2)+1.5];_pos=_pos call wge6h2;_pos=ASLtoATL(_pos);switch(true)do{case((_x select 0)in["snake","rabbit"]):{_0ab=createAgent[(_0js select 4),_pos,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;};case((_x select 0)in["vehammo"]):{_0ab=createVehicle[(_0js select 4),_pos,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;};default{_0ab=createVehicle[(_0js select 4),_pos,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;[_0ab,false]call wgthvn;};};if(_pos select 2<0.1)then{_0ab setVectorUp(surfaceNormal _pos)};if(count(_x select 1)>0)then{_0ab setVariable["inventory_stuff",_x select 1,true];};_09a set[count _09a,_0ab];};};}forEach wgt7bi;if(wg1id4>0||count(_07s)>0)then{private["_01e","_pos"];_06r=2+random 0.5;_05a=_05a+45;_pos=(getPosASL _08h);_pos set[0,(_pos select 0)+(sin _05a)*_06r];_pos set[1,(_pos select 1)+(cos _05a)*_06r];_pos=_pos call wge6h2;_01e=createVehicle["Land_Sack_F",_pos,[],0,"CAN_COLLIDE"];_01e setPosASL _pos;_01e setDir random 360;if(ASLtoATL(_pos)select 2<0.1)then{_01e setVectorUp(surfaceNormal _pos)};[_01e,false]call wgthvn;[_01e,false]call wg1bsw;if(wg1id4>0)then{_01e setVariable["inventory_money",wg1id4,true];};if(count(_07s)>0)then{_01e setVariable["inventory",_07s,true];};_01e setVariable["inventory_key",call wg2ien,true];_01e setVariable["revive_body",_this,true];_09a set[count _09a,_01e];wgayyw=_01e;};call wgx46y;call wglxj9;wg1id4=0;wgt7bi=[[],[],[],[]];_09a};wgbdb2={private["_0js"];_0js=(wgt7bi select _this)call wgxe7d;if(typeName(_0js select 4)==typeName(false))then{private["_01e","_08s"];_01e=call wgs4f1;if(isNull(_01e))then{_01e=call wgz71k;};_08s=([_01e getVariable["inventory",[]],[(wgt7bi select _this)]]call wgui9y);_01e setVariable["inventory",_08s,true];_01e setVariable["inventory_key",call wg2ien,true];}else{private["_0ab","_pos","_06r"];_06r=1+random 0.5;_05a=(getDir player)-10+random 20;_pos=getPosATL player;_pos set[0,(_pos select 0)+(sin _05a)*_06r];_pos set[1,(_pos select 1)+(cos _05a)*_06r];switch(true)do{case((wgt7bi select _this select 0)in["snake","rabbit"]):{_0ab=createAgent[(_0js select 4),getPosATL player,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;};case((wgt7bi select _this select 0)in["vehammo"]):{_0ab=createVehicle[(_0js select 4),getPosATL player,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;};default{_0ab=createVehicle[(_0js select 4),getPosATL player,[],0,"CAN_COLLIDE"];_0ab setPosATL _pos;_0ab setDir random 360;[_0ab,false]call wgthvn;call wgx46y;};};if(count(wgt7bi select _this select 1)>0)then{_0ab setVariable["inventory_stuff",wgt7bi select _this select 1,true];};};player playAction "PutDown";_this call wgju8i;_this call wg7ww1;-1 call wgyfr1;};wgi28b={private["_0us","_0i"];_0us=_this select 0;_0i=[];for "_i" from 0 to(count _0us-1)do{if(_i!=(_this select 1))then{_0i set[count _0i,_0us select _i];};};_0i};wgju8i={if!(_this in[0,1,2,3])exitWith{};wgt7bi set[_this,[]];};wgbyq8={if!(_this in[0,1,2,3])exitWith{};wgt7bi set[_this,[]];if(!isNull(uiNamespace getVariable "Wasteland_PlayerMenu"))then{_this call wg7ww1;if(wgr9lg==_this)then{-1 call wgyfr1;};};};wglypc={_this call wgib3x;if(!isNull(uiNamespace getVariable "Wasteland_PlayerMenu"))then{(_this select 1)call wg7ww1;if(_this select 1==wgr9lg)then{(_this select 1)call wgyfr1;};};};wgo2up={[_this,call wguyct]call wgib3x;};wgib3x={private["_0i","_0ts","_name","_0vs"];_0i=false;_0ts=_this select 1;if!(_0ts in[0,1,2,3])exitWith{false};if(typeName(_this select 0)==typeName(""))then{_name=_this select 0;_0vs=[];}else{_name=_this select 0 select 0;_0vs=_this select 0 select 1;};wgt7bi set[_0ts,[_name,_0vs]];_0i=true;_0i};wguyct={private["_0i"];_0i=-1;for "_i" from 0 to 3 do{if(count(wgt7bi select _i)==0)exitWith{_0i=_i;};};_0i};wgui9y={private["_0i"];_0i=[];{if(count(_x)==2)then{_0i set[count _0i,_x];};}forEach(_this select 0)+(_this select 1);_0i};wg2ien={private["_0ac"];_0ac=[];for "_i" from 1 to 16 do{_0bc=48+(floor random(9));_0ac=_0ac+[_0bc];};toString(_0ac)};wg578e={private["_08f","_01p","_0i","_09s","_0qa"];_08f=[];_01p=[];{if(count(_x)==2)then{_09s=-1;_0qa=_x select 0;switch(_x select 0)do{case "fuelcan":{if("empty" in(_x select 1))then{_0qa="fuelcan_empty";};};};for "_i" from 0 to(count _01p-1)do{if((_01p select _i select 0)==_0qa)exitWith{_09s=_i;};};if(_09s==-1)then{_01p set[count _01p,[_0qa,1]];_08f set[count _08f,_0qa];}else{_01p set[_09s,[_0qa,(_01p select _09s select 1)+1]];};};}forEach _this;_0i=[_08f,_01p];_0i};wgeuz8={private["_0i","_0us","_name","_0vs"];_0i=-1;_0us=_this select 0;if(typeName(_this select 1)==typeName(""))then{_name=_this select 1;_0vs=[];}else{_name=_this select 1 select 0;_0vs=_this select 1 select 1;};for "_i" from 0 to(count _0us-1)do{if((_0us select _i select 0)==_name)then{if(count(_0vs)==0&&count(_0us select _i select 1)==0)then{_0i=_i;}else{if(typeName(_0vs select 0)==typeName(_0us select _i select 1 select 0))then{if((_0vs select 0)==(_0us select _i select 1 select 0))then{_0i=_i;};};};};if(_0i!=-1)exitWith{};};_0i};wgphx6={private["_05d","_0km"];_0js=_this call wgxe7d;_05d=format["%4<br/><img image='%1' size='4'/><br/>%2<br/><br/>%5:<br/>%3",_0js select 0,_0js select 1,call wgeujb,localize "STR_WL_Dlg_PlayerMenu_MessageYouHaveTaken",localize "STR_WL_Dlg_PlayerMenu_Inventory"];hint parseText _05d;true};wgeujb={private["_0i"];_0i="";for "_i" from 0 to 3 do{if(count(wgt7bi select _i)!=0)then{_0km=(wgt7bi select _i)call wgxe7d;_0i=_0i+format["<img image='%1' size='1.8'/>",_0km select 0];}else{_0i=_0i+"<img image='i\mapslot.paa' size='1.8'/>";};if(_i==1)then{_0i=_0i+"<br/>";};};_0i};wgxe7d={private["_0i","_name","_0vs"];_0i=[];if(typeName(_this)==typeName(""))then{_name=_this;_0vs=[];}else{_name=_this select 0;_0vs=_this select 1;};switch(_name)do{case "money":{_0i=["i\m.paa",localize "STR_WL_Dlg_PlayerMenu_ItemMoney",localize "STR_WL_Dlg_PlayerMenu_ItemMoneyText",localize "STR_WL_Dlg_PlayerMenu_ButtonDrop",false];};case "food":{_0i=["i\f.paa",localize "STR_WL_Dlg_PlayerMenu_ItemFood",localize "STR_WL_Dlg_PlayerMenu_ItemFoodText",localize "STR_WL_Dlg_PlayerMenu_ButtonEat",false];};case "water":{_0i=["i\w.paa",localize "STR_WL_Dlg_PlayerMenu_ItemWater",localize "STR_WL_Dlg_PlayerMenu_ItemWaterText",localize "STR_WL_Dlg_PlayerMenu_ButtonDrink",false];};case "repairkit":{_0i=["i\a3_repair.paa",localize "STR_WL_Dlg_PlayerMenu_ItemRepair",localize "STR_WL_Dlg_PlayerMenu_ItemRepairText",localize "STR_WL_Dlg_PlayerMenu_ButtonRepair","Land_Suitcase_F"];};case "fuelcan":{if("empty" in _0vs)then{_0i=["i\a3_fuelempty.paa",localize "STR_WL_Dlg_PlayerMenu_ItemFuelcanEmpty",localize "STR_WL_Dlg_PlayerMenu_ItemFuelcanEmptyText",false,"Land_CanisterFuel_F"];}else{_0i=["i\a3_fuel.paa",localize "STR_WL_Dlg_PlayerMenu_ItemFuelcan",localize "STR_WL_Dlg_PlayerMenu_ItemFuelcanText",localize "STR_WL_Dlg_PlayerMenu_ButtonRefuel","Land_CanisterFuel_F"];};};case "vehammo":{_0i=["i\a3_vehammo.paa",localize "STR_WL_Dlg_PlayerMenu_ItemVehammo",localize "STR_WL_Dlg_PlayerMenu_ItemVehammoText",localize "STR_WL_Dlg_PlayerMenu_ButtonRearm","Land_Ammobox_rounds_F"];};case "snake":{_0i=["i\ui_snake.paa",localize "STR_WL_Dlg_PlayerMenu_ItemSnake",localize "STR_WL_Dlg_PlayerMenu_ItemSnakeText",false,"Snake_random_F"];};case "rabbit":{_0i=["i\ui_rabbit.paa",localize "STR_WL_Dlg_PlayerMenu_ItemRabbit","What, behind the rabbit?",false,"Rabbit_F"];};case "respawn":{_0i=["i\a3_respawn.paa","Respawn beacon","One time use item that setups respawn beacon making your next respawn a paradrop above it","Setup","Land_SatellitePhone_F"];};case "bomb":{_0i=["i\bomb.paa","Time Bomb","Time bomb description. Explodes in 30 seconds after being armed.","Arm","bomb"];};};_0i};wgfwj3={wg9bik=serverTime+wg86i6;true spawn wg5g2x;true spawn wgicqh;true spawn wg2rff;true spawn wg4nrr;};wgu9ir={wgft2g=serverTime+wgoxy7*wg6i97;};wgi56j={wg9bik=serverTime+wg86i6*wg6i97;};wgychn={call wgu9ir;call wgi56j;};wg5g2x={while{true}do{waitUntil{!wggw5j};waitUntil{wgwsvk>0};call wgu9ir;waitUntil{sleep 5;serverTime>=wgft2g||wgft2g-serverTime>6000||!alive player};if(!alive player||wgft2g-serverTime>6000)then{waitUntil{alive player};}else{wgwsvk=wgwsvk-10;if(wgwsvk<0)then{wgwsvk=0;};if(wgwsvk<10&&wgxspa)then{wgwsvk=10;};call wgmw2n;};};};wgicqh={while{true}do{waitUntil{!wggw5j};waitUntil{wgsna4>0};call wgi56j;waitUntil{sleep 5;serverTime>=wg9bik||wg9bik-serverTime>6000||!alive player};if(!alive player||wg9bik-serverTime>6000)then{waitUntil{alive player};}else{wgsna4=wgsna4-10;if(wgsna4<0)then{wgsna4=0;};if(wgsna4<10&&wgxspa)then{wgsna4=10;};call wgmw2n;};};};wg2rff={_0bn=["HitHead","HitBody","HitHands","HitLegs"];while{true}do{waitUntil{sleep 3;damage player<0.8&&wgwsvk>=wg6cum&&wgsna4>=wg6cum};_0na=[damage player];{_0na set[count _0na,player getHitPointDamage _x]}forEach _0bn;if(({_x>0}count _0na)>0)then{_0ea=damage player;_0fl=false;{_0at=player getHitPointDamage _x;if(_0at>_0ea)then{player setHitPointDamage[_x,_0ea max(_0at-(if(_0ea<0.1)then{0.04}else{0.02}))];_0fl=true;};}forEach _0bn;if(!_0fl)then{_0bt=[];{if(player getHitPointDamage _x<_0ea-0.01)then{_0bt=_0bt+[[_x,(player getHitPointDamage _x)]];};}forEach _0bn;player setDamage(0 max(_0ea-0.01));{player setHitPointDamage[_x select 0,_x select 1];}forEach _0bt;};true spawn wgmp1t;true spawn wgocyz;[[0,1,0,0.5],0.5]spawn wg4x1e;};sleep 3;};};wg4nrr={_0bn=["HitHead","HitBody","HitHands","HitLegs"];wg3yg9=0;while{true}do{waitUntil{wgwsvk==0||wgsna4==0};wg3yg9=serverTime+wgstnn;waitUntil{sleep 5;if(wgwsvk==0&&wgsna4==0)then{wg3yg9=serverTime;};if(wgwsvk==0||wgsna4==0)then{true spawn wg4x1e;player setFatigue 1;};serverTime>=wg3yg9||wg3yg9-serverTime>6000||(wgwsvk>0&&wgsna4>0)||!alive player};if((wgwsvk==0||wgsna4==0)&&alive player)then{waitUntil{sleep 5;_0bt=[];{_0bt=_0bt+[[_x,((player getHitPointDamage _x)+0.01)min 1]];}forEach _0bn;player setDamage(damage player+0.05);{player setHitPointDamage[_x select 0,_x select 1];}forEach _0bt;if(wgwsvk==0||wgsna4==0)then{true spawn wg4x1e;true spawn wgmp1t;[[1,0,0,1],0.5]spawn wgocyz;player setFatigue 1;};!alive player||(wgwsvk>0&&wgsna4>0)};};};};