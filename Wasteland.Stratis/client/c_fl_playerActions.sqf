/*
	ArmA 3 Wasteland
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	
	Special build for Dwarden
	
	ESABQIEXHTFRGOFR
*/
#include "hpp\settings.hpp"
if(isNil{wgw5hq})then{wgw5hq=false;};
#define wgqaac	15
wg7tf7={if(wg6z48)exitWith{hint localize "STR_WL_Dlg_PlayerMenu_MessageBusy";};private["_0dj","_name"];_0dj=_this;_name=_0dj call wgyecz;wgoy2p=[wg5rhq,player,_0dj getVariable["revive_player",objNull]];publicVariable "wgoy2p";[format["Reviving %1",_name],format["%1 revived",_name],wgqaac,_0dj,{(getPosATL(_this)distance getPosATL(player)>5)||isNull(_this)||!alive(_this getVariable["revive_player",objNull])},{},{wgiqhx=_this;publicVariable "wgiqhx";if(isServer)then{publicVariableServer "wgiqhx";};}]spawn wg4o62;};wgdkti={hint parseText format["%1 %2:<br/><t size='3'>%3%4</t><br/>(%5 / %6)",localize "STR_WL_Acts_CheckVehicleAmmoText",getText(configFile>>"CfgVehicles">>typeOf(_this)>>"displayname"),floor(getAmmoCargo _this/(_this getVariable["ammocargo",1])*100),"%",((getAmmoCargo _this)*getNumber(configFile>>"CfgVehicles">>typeOf(_this)>>"transportAmmo"))call wgzuan,(getNumber(configFile>>"CfgVehicles">>typeOf(_this)>>"transportAmmo"))call wgzuan];_this setAmmoCargo(_this getVariable["ammocargo",1]);};wgnhwf={if(!isNil{wgezyy})then{if(diag_tickTime>(wgcmn4+1))then{wgcmn4=diag_tickTime;wgy6nd=diag_tickTime+1;wghcfp=[wgezyy,getDir player];publicVariable "wghcfp";wghcfp call wg95mw;player playAction "PutDown";};};};wgagvi={if(!isNil{wg4e1g})then{wggk6m removeAction wg4e1g;};wg4e1g=player addAction["<img image=""i\pm.paa""/> <t color=""#be6300"">Player Menu</t>",{true call wgu2to},nil,-30,false,false];};wg3n3u={call wgagvi;call wg7ahn;true spawn wg4q95;};wg7ahn={if(!isNil{wgqi9s})then{{wggk6m removeAction _x;}forEach wgqi9s};wgw5hq=true;wggk6m=player;wgqi9s=[];_0yo=-6;_0zo=-15;wghh7r=false;wgudwa=objNull;_01o=player addAction["food action",{[wgudwa,"food"]call wgs9u5},nil,_0yo,true,false,"","wghh7r"];wgx2qu=false;wg178p=objNull;_02o=player addAction["water action",{[wg178p,"water"]call wgs9u5},nil,_0yo,true,false,"","wgx2qu"];wgvgzq=false;wge349=objNull;_03o=player addAction["money action",{wge349 call wg2jpq},nil,_0yo,true,true,"","wgvgzq"];wgdtck=false;_04o=["vehammo",[]]call wgxe7d;_05o=player addAction[format["<img image='%1'/> Pick up %2",_04o select 0,_04o select 1],{["vehammo",[]]call wglxs7},nil,_0yo,true,true,"","wgdtck"];wg5emi=false;_06o=["repairkit",[]]call wgxe7d;_07o=player addAction[format["<img image='%1'/> Pick up %2",_06o select 0,_06o select 1],{["repairkit",[]]call wglxs7},nil,_0yo,true,true,"","wg5emi"];wg6xj9=false;wgrfxt=objNull;_08o=player addAction["take repair from truck action",{wg1dnh=wgrfxt;},nil,_0yo,false,false,"","wg6xj9 && (vehicle player == player) && !isNil{wgiztd}"];wgh7mz=false;_09o=["fuelcan",[]]call wgxe7d;_0ap=player addAction[format["<img image='%1'/> Pick up %2",_09o select 0,_09o select 1],{["fuelcan",[]]call wglxs7},nil,_0yo,true,true,"","wgh7mz"];wg4i8v=false;_0bp=["fuelcan",["empty"]]call wgxe7d;_0cp=player addAction[format["<img image='%1'/> Pick up %2",_0bp select 0,_0bp select 1],{["fuelcan",["empty"]]call wglxs7},nil,_0yo,true,true,"","wg4i8v"];wg5176=false;_0dp=player addAction[format["<img image='%1'/> Fill empty fuelcan",_0bp select 0],{true call wghy5b},nil,_0yo,true,true,"","wg5176"];wgvqdi=false;wg12ca=objNull;_0ep=player addAction["food source action",{wg12ca call wg6fll},nil,_0yo,true,false,"","wgvqdi"];wg1vr8=false;wgygi7=objNull;_0fp=player addAction["water source action",{wgygi7 call wg6fll},nil,_0yo,true,false,"","wg1vr8"];wgezsm=false;_0gp=["bomb",[]]call wgxe7d;_0hp=player addAction[format["<img image='%1'/> Pick up %2",_0gp select 0,_0gp select 1],{["bomb",[]]call wglxs7},nil,_0yo,true,true,"","wgezsm"];wgce3n=false;_0ip=["snake",[]]call wgxe7d;_0jp=player addAction[format["<img image='%1'/> Pick up %2",_0ip select 0,_0ip select 1],{["snake",[]]call wglxs7},nil,_0yo,false,false,"","wgce3n"];wga8xa=false;_0kp=["rabbit",[]]call wgxe7d;_0lp=player addAction[format["<img image='%1'/> Pick up %2",_0kp select 0,_0kp select 1],{["rabbit",[]]call wglxs7},nil,_0yo,false,false,"","wga8xa"];_0mp=-1;wgd2dx=false;wgdqrf=-1;_0np=player addAction["<img image='i\act_money.paa'/> Buy from store",{wgdqrf call wgjo8o;},nil,10,true,true,"","wgd2dx"];_0op=player addAction["<img image='i\act_money.paa'/> Sell to store",{wgdqrf call wgvvir;},nil,10,true,true,"","wgd2dx"];_0pp=player addAction["<img image='i\act_money.paa'/> Request vehicle",{systemChat "Request vehicle";},nil,10,true,true,"","wgd2dx && false"];wg4psj=false;wg5e7p=objNull;_0qp=player addAction["revive",{wg5e7p call wg7tf7},nil,15,true,false,"","wg4psj"];wg96dm=false;wg99aa=objNull;_0rp=player addAction[format["<img image='i\a3_vehammo.paa'/> %1",localize "STR_WL_Acts_CheckVehicleAmmoAction"],{wg99aa call wgdkti},nil,_0yo,true,false,"","wg96dm"];wgf6r1=false;_0sp=player addAction[localize "STR_ACTION_EJECT",{wgshie=true;},nil,6.1,false,false,"","wgf6r1"];wgtqzi=false;wgyz7i=objNull;_0tp=player addAction["salvage action",{wgyz7i call wgkm81},nil,_0yo,false,false,"","wgtqzi"];wgcr8i=false;wgx6zl=objNull;_0up=player addAction["chemlight action",{wgx6zl call wg4rtn},nil,_0yo,false,false,"","wgcr8i && (vehicle player == player)"];_0vp=player addAction["chemlight drop action",{call wguxaj},nil,_0yo,false,false,"","!wgcr8i && !isNull(wgcnta)"];wg9wyn=false;wgezyy=objNull;wgcmn4=diag_tickTime;_0wp=player addAction["push boat action",{wgezyy call wgnhwf},nil,_0zo,false,false,"","wg9wyn && (vehicle player == player)"];wgqi9s=[_01o,_02o,_03o,_05o,_07o,_0ap,_0cp,_0dp,_0ep,_0fp,_0hp,_0jp,_0lp,_0mp,_0np,_0op,_0sp,_0qp,_0rp,_0tp,_0up,_0vp,_0wp,_08o,_0pp];};wg4q95={private["_0zp","_01p","_02p","_food_sources"];_01o=wgqi9s select 0;_02o=wgqi9s select 1;_03o=wgqi9s select 2;_05o=wgqi9s select 3;_07o=wgqi9s select 4;_0ap=wgqi9s select 5;_0cp=wgqi9s select 6;_0dp=wgqi9s select 7;_0ep=wgqi9s select 8;_0fp=wgqi9s select 9;_0hp=wgqi9s select 10;_0jp=wgqi9s select 11;_0lp=wgqi9s select 12;_0mp=wgqi9s select 13;_0np=wgqi9s select 14;_0op=wgqi9s select 15;_0sp=wgqi9s select 16;_0qp=wgqi9s select 17;_0rp=wgqi9s select 18;_0tp=wgqi9s select 19;_0up=wgqi9s select 20;_0vp=wgqi9s select 21;_0wp=wgqi9s select 22;_08o=wgqi9s select 23;_0pp=wgqi9s select 24;_0xp=["food",[]]call wgxe7d;_0yp=["water",[]]call wgxe7d;_04o=["vehammo",[]]call wgxe7d;_06o=["repairkit",[]]call wgxe7d;_09o=["fuelcan",[]]call wgxe7d;_0bp=["fuelcan",["empty"]]call wgxe7d;_0ip=["snake",[]]call wgxe7d;_0kp=["rabbit",[]]call wgxe7d;_0gp=["bomb",[]]call wgxe7d;_08h=player;while{true}do{wghh7r=false;wgx2qu=false;wgvgzq=false;wgdtck=false;wg5emi=false;wgh7mz=false;wg4i8v=false;wg5176=false;wgvqdi=false;wg1vr8=false;wgce3n=false;wga8xa=false;wgezsm=false;wgd2dx=false;wg4psj=false;wg96dm=false;wgtqzi=false;wgcr8i=false;wg9wyn=false;wg6xj9=false;if(!alive _08h)exitWith{};if(vehicle player==player)then{_0zp=nearestObjects[player,["Land_Sack_F"],wgzfbj];{_01e=_x;if((_01e getVariable["inventory_key","fail"])!=(_01e getVariable["inventory_localkey",""]))then{_01e setVariable["inventory_localkey",_01e getVariable["inventory_key","fail"]];_01p=(_01e getVariable["inventory",[]])call wg578e;_01e setVariable["inventory_counts",_01p];{_01e setVariable[format["ic_%1",_x select 0],_x select 1];}forEach(_01p select 1);if(wgudwa==_01e)then{wgudwa=objNull;};if(wg178p==_01e)then{wg178p=objNull;};if(wge349==_01e)then{wge349=objNull;};}else{_01p=_01e getVariable["inventory_counts",[[],[]]];};if(!wghh7r)then{if("food" in(_01p select 0))then{wghh7r=true;if(wgudwa!=_01e)then{wgudwa=_01e;player setUserActionText[_01o,format["<img image='%1'/> Take %2 (x%3)",_0xp select 0,_0xp select 1,_01e getVariable["ic_food","ERROR"]]];};};};if(!wgx2qu)then{if("water" in(_01p select 0))then{wgx2qu=true;if(wg178p!=_01e)then{wg178p=_01e;player setUserActionText[_02o,format["<img image='%1'/> Take %2 (x%3)",_0yp select 0,_0yp select 1,_01e getVariable["ic_water","ERROR"]]];};};};if(!wgvgzq)then{if(_01e getVariable["inventory_money",0]>0)then{wgvgzq=true;if(wge349!=_01e)then{wge349=_01e;player setUserActionText[_03o,format["<img image='i\m.paa'/> Take $%1",_01e getVariable["inventory_money","ERROR"]]];};};};if(wghh7r&&wgx2qu&&wgvgzq)exitWith{};}forEach _0zp;{if(_x getVariable["food_count",0]>0)exitWith{wgvqdi=true;if(wg12ca!=_x)then{wg12ca=_x;};player setUserActionText[_0ep,format["<img image='%1'/> Get %2 from sacks (x%3)",_0xp select 0,_0xp select 1,_x getVariable["food_count",0]]];};}forEach(nearestObjects[player,["Land_Sacks_goods_F"],wgvjcy]);{if(_x getVariable["water_count",0]>0)exitWith{wg1vr8=true;if(wgygi7!=_x)then{wgygi7=_x;};player setUserActionText[_0fp,format["<img image='%1'/> Fill %2 from barrel (x%3)",_0yp select 0,_0yp select 1,_x getVariable["water_count",0]]];};}forEach(nearestObjects[player,["Land_BarrelWater_F"],wgvjcy]);if(!isNull(cursorTarget))then{if(alive cursorTarget)then{if(player distance cursorTarget<10)then{if((getFuelCargo cursorTarget)>0)then{if(([wgt7bi,["fuelcan",["empty"]]]call wgeuz8)!=-1)then{wg5176=true;};};};};};{if(typeOf _x==(_04o select 4))exitWith{wgdtck=true;};}forEach(player nearObjects[(_04o select 4),wgvjcy]);{if(typeOf _x=="Land_Suitcase_F")exitWith{wg5emi=true;};}forEach(player nearObjects["Land_Suitcase_F",wgvjcy]);_02p=player nearObjects["Land_CanisterFuel_F",wgvjcy];{if(count(_x getVariable["inventory_stuff",[]])==0)then{wgh7mz=true;}else{wg4i8v=true;};if(wgh7mz&&wg4i8v)exitWith{};}forEach _02p;{if(alive _x)exitWith{wgce3n=true;};}forEach(player nearObjects[(_0ip select 4),wgvjcy]);{if(alive _x)exitWith{wga8xa=true;};}forEach(player nearObjects[(_0kp select 4),wgvjcy]);{if(true)exitWith{wgezsm=true;};}forEach(player nearObjects["bomb",wgvjcy]);{if((player distance _x<3)&&alive(_x getVariable["revive_player",objNull])&&(((_x getVariable["revive_side",civilian]==playerSide)&&(playerSide!=independent))||(_x getVariable["revive_group",grpNull]==group player)))exitWith{if(wg5e7p!=objNull)then{player setUserActionText[_0qp,format["<img image='%1' color='#ee0000'/> Revive %2","a3\ui_f\data\map\VehicleIcons\pictureheal_ca.paa",_x call wgyecz]];};wg4psj=true;wg5e7p=_x;};}forEach wgf9zc;if(!isNull(cursorTarget))then{if(alive cursorTarget)then{if(player distance cursorTarget<20)then{if(getNumber(configFile>>"CfgVehicles">>typeOf(cursorTarget)>>"transportAmmo")>0)then{wg96dm=true;wg99aa=cursorTarget;};};};};if(!isNull(cursorTarget))then{if(!alive cursorTarget)then{if(player distance cursorTarget<20)then{if(({if(cursorTarget isKindOf _x)exitWith{1}}count["LandVehicle","Ship","Air"]>0)||(cursorTarget getVariable["can_salvage",false]))then{if(wgyz7i!=cursorTarget)then{player setUserActionText[_0tp,format["<img image='i\m.paa'/> Salvage %1",getText(configFile>>"CfgVehicles">>typeOf(cursorTarget)>>"displayName")]];};wgtqzi=true;wgyz7i=cursorTarget;};};};};if(!isNull(cursorTarget))then{if(alive cursorTarget)then{if(player distance cursorTarget<10)then{if(getRepairCargo cursorTarget>0)then{if(cursorTarget getVariable["repairkit_available_at",0]<serverTime)then{if(wgrfxt!=cursorTarget)then{player setUserActionText[_08o,format["<img image='%1'/> Take %2 from %3",_06o select 0,_06o select 1,getText(configFile>>"CfgVehicles">>typeOf(cursorTarget)>>"displayName")]];};wgrfxt=cursorTarget;wg6xj9=true;};};};};};if(isNull(wgcnta))then{_06f=nearestObjects[player,[],2];if(count(_06f)>0)then{_03p={if(((_x isKindOf "Grenade")||(_x isKindOf "TimeBombCore")||(_x isKindOf "GrenadeCore"))&&isNull(attachedTo _x))exitWith{_x};}forEach _06f;if(!isNil{_03p})then{if(!isNull(_03p))then{if(wgx6zl!=_03p)then{_0fa=configFile>>"CfgMagazines">>(typeOf(_03p)call wg92gr);if(isClass(_0fa))then{player setUserActionText[_0up,format["<img image='%1'/> %2",getText(_0fa>>"picture"),format[localize "STR_WL_Acts_TakeChemlight",getText(_0fa>>"displayname")]]];player setUserActionText[_0vp,format["<img image='%1'/> %2",getText(_0fa>>"picture"),format[localize "STR_WL_Acts_DropChemlight",getText(_0fa>>"displayname")]]];}else{_03p=objNull;};};if(!isNull(_03p))then{wgcr8i=true;wgx6zl=_03p;};};};};};if(!isNull(cursorTarget))then{if(abs(speed cursorTarget)<1)then{if(player distance cursorTarget<10)then{if(!(cursorTarget isKindOf "CAManBase")&&(!(cursorTarget isKindOf "Air")||!alive cursorTarget)&&(cursorTarget isKindOf "AllVehicles"))then{if(wgezyy!=cursorTarget)then{player setUserActionText[_0wp,format["<img image='i\r3f_take.paa'/> %1",format[localize "STR_WL_R3F_Action_PushVehicle",getText(configFile>>"CfgVehicles">>typeOf(cursorTarget)>>"displayname")]]];};wg9wyn=true;wgezyy=cursorTarget;};};};};if(!isNil{wg57oa})then{for "_i" from 0 to(count wg57oa-1)do{if(cursorTarget==(wg57oa select _i select 0))exitWith{if(player distance(wg57oa select _i select 0)<7)then{wgdqrf=_i;wgd2dx=true;};};};};};sleep 0.5;};};