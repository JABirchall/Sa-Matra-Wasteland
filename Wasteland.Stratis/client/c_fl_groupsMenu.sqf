/*
	ArmA 3 Wasteland
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	
	Special build for Dwarden
	
	ESABQIEXHTFRGOFR
*/
#include "hpp\idcs.hpp"
#include "hpp\settings.hpp"
wgryvu={createDialog "Wasteland_Groups";private["_0jk"];disableSerialization;_0jk=uiNamespace getVariable "Wasteland_Groups";[_0jk,""]call bis_fnc_guiEffectTiles;true call wg9861;true call wgxt3x;(_0jk displayCtrl wg4gxv)ctrlShow false;(_0jk displayCtrl wg885q)ctrlShow false;(_0jk displayCtrl wg8zet)ctrlSetText wg4sje;(_0jk displayCtrl wg8zet)ctrlShow!isStreamFriendlyUIEnabled;true spawn wgdeek;};wgsr3e={if(["Group management menu is not stream safe and will display nicknames of people on the server. Make sure you hide this menu from your stream before you press ""OK"".","Stream Safe Warning",true,true]call BIS_fnc_GUImessage)then{true call wgryvu;};};wgdeek={private["_0jk"];disableSerialization;_0jk=uiNamespace getVariable "Wasteland_Groups";while{!isNull(_0jk)}do{_06l=count units group player;waitUntil{isNull(_0jk)||((count units group player)!=_06l)};if(!isNull(_0jk))then{true call wg9861;true call wgxt3x;};};};wg9861={private["_0jk","_07l","_08l"];private["_09l","_0am","_0bm","_0df"];_0jk=uiNamespace getVariable "Wasteland_Groups";_07l=_0jk displayCtrl wgjksw;_08l=_0jk displayCtrl wgqp3e;if((count units group player)==1)then{_08l ctrlSetStructuredText parseText localize "STR_WL_Dlg_Groups_StatusAlone";}else{if((leader group player)==player)then{_08l ctrlSetStructuredText parseText localize "STR_WL_Dlg_Groups_StatusLeader";}else{_08l ctrlSetStructuredText parseText localize "STR_WL_Dlg_Groups_StatusMember";};};_09l="Your group:";_0am=1;{_0am=_0am+1;_0bm=if(leader group player==_x)then{"leader"}else{"unit"};_0df=[];_09l=format["%1<br/>%2",_09l,format["<img image='i\grp_%1.paa' size='0.9'/> %3%2",_0bm,if(isStreamFriendlyUIEnabled&&(_x==player))then{localize "STR_WL_Me"}else{name _x},if(count(_0df)==0)then{""}else{format["<img image='%2' size='0.9'/> ",_0df select 0,_0df select 1]}]];}forEach(units group player);_07l ctrlSetStructuredText parseText _09l;_07l ctrlSetPosition[0,0,0.4-((2/250)+(1/250))*(safezoneH/safezoneW),(((((safezoneW/safezoneH)min 1.2)/1.2)/25)*0.8)*_0am];_07l ctrlCommit 0;};wgxt3x={private["_0jk","_0cm","_07l","_0dm","_08l"];private["_0e","_0hm","_0im","_0jm","_0fm","_0gm"];_0jk=uiNamespace getVariable "Wasteland_Groups";_0cm=_0jk displayCtrl wggmwv;_07l=_0jk displayCtrl wgjksw;_0dm=_0jk displayCtrl wg4gxv;_0em=_0jk displayCtrl wg885q;_08l=_0jk displayCtrl wgqp3e;lbClear _0cm;_0fm=[];{if(wghrav in(_x getVariable["invites",[]]))then{_0fm pushBack(getPlayerUID _x);};}forEach playableUnits;_0gm=player getVariable["invites",[]];{if(side _x==playerSide)then{_0e=lbSize _0cm;_0cm lbAdd format["%1",if(isStreamFriendlyUIEnabled&&(_x==player))then{localize "STR_WL_Me2"}else{name _x}];_0hm="i\grp_free.paa";_0im="FREE";if(((getPlayerUID _x)in _0fm)&&((getPlayerUID _x)in _0gm))then{_0im="BOTH";_0hm="i\grp_both.paa";}else{if((getPlayerUID _x)in _0fm)then{_0im="GOT";_0hm="i\grp_got.paa";};if((getPlayerUID _x)in _0gm)then{_0im="SENT";_0hm="i\grp_sent.paa";};};if(count units group _x>1)then{if(group _x==group player)then{if(_x==(leader group player))then{_0hm="i\grp_leader.paa";}else{_0hm="i\grp_unit.paa";};_0im="GROUP";}else{_0hm="i\grp_busy.paa";_0im="BUSY";if(leader group _x==_x)then{if((getPlayerUID _x)in _0fm)then{_0im="GOT";_0hm="i\grp_got.paa";};};};};_0cm lbSetPicture[_0e,_0hm];_0jm=format["grouplist_%1",getPlayerUID _x];_0cm lbSetData[_0e,_0jm];uiNamespace setVariable[_0jm,[_x,getPlayerUID _x,_0im]];}}forEach playableUnits;true call wg15fo;};wg15fo={private["_0jk","_0cm"];_0jk=uiNamespace getVariable "Wasteland_Groups";_0cm=_0jk displayCtrl wggmwv;[_0cm,lbCurSel _0cm]call wgo47m;};wgo47m={_0jm=(_this select 0)lbData(_this select 1);_0km=uiNamespace getVariable[_0jm,[]];uiNamespace setVariable["grouplist_selected",_0km];private["_0jk","_0dm","_0em"];_0jk=uiNamespace getVariable "Wasteland_Groups";_0dm=_0jk displayCtrl wg4gxv;_0em=_0jk displayCtrl wg885q;_0dm ctrlShow false;_0em ctrlShow false;if((_0km select 0==player)||false)then{}else{switch((_0km select 2))do{case "FREE":{if(leader group player==player)then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionSendInvite";uiNamespace setVariable["grouplist_b1","INVITE"];};};case "GROUP":{if(leader group player==player)then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionKick";uiNamespace setVariable["grouplist_b1","KICK"];}else{if((leader group player)==(_0km select 0))then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionLeave";uiNamespace setVariable["grouplist_b1","LEAVE"];};};};case "BOTH":{if(leader group player==player)then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionCancelInvite";uiNamespace setVariable["grouplist_b1","INVITE_REMOVE"];_0em ctrlShow true;_0em ctrlSetText localize "STR_WL_Dlg_Groups_ActionAcceptInvite";uiNamespace setVariable["grouplist_b2","INVITE_ACCEPT"];};};case "GOT":{if(leader group player==player)then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionSendInvite";uiNamespace setVariable["grouplist_b1","INVITE"];_0em ctrlShow true;_0em ctrlSetText localize "STR_WL_Dlg_Groups_ActionAcceptInvite";uiNamespace setVariable["grouplist_b2","INVITE_ACCEPT"];};};case "SENT":{if(leader group player==player)then{_0dm ctrlShow true;_0dm ctrlSetText localize "STR_WL_Dlg_Groups_ActionCancelInvite";uiNamespace setVariable["grouplist_b1","INVITE_REMOVE"];};};};};};wgeb3t={_0gj=uiNamespace getVariable format["grouplist_b%1",_this];_0km=uiNamespace getVariable["grouplist_selected",[]];switch(_0gj)do{case "INVITE":{if(!isNull(_0km select 0))then{_0gm=player getVariable["invites",[]];if!((_0km select 1)in _0gm)then{_0gm pushBack(_0km select 1);player setVariable["invites",_0gm,true];wguaoq=player;publicVariable "wguaoq";};true call wgxt3x;}else{hint localize "STR_WL_Dlg_Groups_HintStatusChanged";true call wgxt3x;};};case "INVITE_REMOVE":{[player,(_0km select 1)]call wghbqu;true call wgxt3x;};case "INVITE_ACCEPT":{if(((count units group player)==1)&&!isNull(_0km select 0)&&([_0km select 1,wghrav]call wg9io6))then{wgy6hw=[player,group(_0km select 0)];publicVariableServer "wgy6hw";if(count(player getVariable["invites",[]])>0)then{player setVariable["invites",nil,true];};}else{hint localize "STR_WL_Dlg_Groups_HintStatusChanged";};};case "KICK":{if(((count units group player)>1)&&(group player==(group(_0km select 0))))then{wg9pm7=[(_0km select 0),playerSide];publicVariableServer "wg9pm7";[player,(_0km select 1)]call wghbqu;}else{hint localize "STR_WL_Dlg_Groups_HintStatusChanged";};};case "LEAVE":{if(((count units group player)>1))then{wg9pm7=[player,playerSide];publicVariableServer "wg9pm7";_0cf=({if(getPlayerUID _x==(_0km select 1))exitWith{_x}}forEach playableUnits);if(!isNil{_0cf})then{[_0cf,wghrav]call wghbqu;};}else{hint localize "STR_WL_Dlg_Groups_HintStatusChanged";};};};};wglq3p={};wglmfw={};wghbqu={private["_0cf","_uid"];_0cf=_this select 0;_uid=_this select 1;if(_uid in(_0cf getVariable["invites",[]]))then{_0cf setVariable["invites",(_0cf getVariable["invites",[]])-[_uid],true];};};wgqnwr={};wg9io6={private["_0lm","_0mm"];_0lm=_this select 0;_0mm=_this select 1;_0cf=({if(getPlayerUID _x==_0lm)exitWith{_x}}forEach playableUnits);if(!isNil{_0cf})then{_0mm in(_0cf getVariable["invites",[]])}else{false};};