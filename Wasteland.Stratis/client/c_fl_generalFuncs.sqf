/*
	ArmA 3 Wasteland
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	
	Special build for Dwarden
	
	ESABQIEXHTFRGOFR
*/
#include "hpp\idcs.hpp"
#include "hpp\settings.hpp"
wg8phi={if(isNil{wgdxis})exitWith{};private["_0qk","_0of","_0rk","_0yi"];_0qk=_this select 0;_0of=_this select 1;_0rk=_this select 2;_0yi=wgdxis select([blufor,opfor,independent,civilian]find playerSide);switch(_0qk)do{case wgxcy6:{_0sk=_0rk select 0;_0tk=_0rk select 1;if(player distance _0sk<100)then{if(((side group _0of==playerSide)&&(playerSide!=independent))||(group _0of==group player))then{_0yi globalChat format[localize "STR_WL_Warning_Explosive",name _0of,getText(configFile>>"CfgMagazines">>_0tk>>"displayname")];};};};case wgxf74:{_0uk=_0rk select 0;_0vk=_0rk select 1;if(player distance _0of<60)then{if(((side group _0of==playerSide)&&(playerSide!=independent))||(group _0of==group player))then{_0yi globalChat format[localize "STR_WL_Warning_Sold",name _0of,switch(true)do{case(typeName _0uk==typeName true):{if(_0uk)then{localize "STR_WL_Warning_Sold_Crate"}else{localize "STR_WL_Warning_Sold_Ground"}};default{format[localize "STR_WL_Warning_Sold_Vehicle",getText(configFile>>"CfgVehicles">>typeOf(_0uk)>>"displayname")]};},_0vk];};};};case wg9q34:{_0nh=_0rk;if(player distance _0nh<200)then{if(((side group _0of==playerSide)&&(playerSide!=independent))||(group _0of==group player))then{_0yi globalChat format[localize "STR_WL_Warning_RadarOff",name _0of];};};};case wg5rhq:{_0wk=_0rk;if(player==_0wk)then{_0yi globalChat format[localize "STR_WL_Warning_BeingRevived",name _0of];};};case wgk94m:{_0xk=_0rk;if((player distance _0of)<80)then{_0yi globalChat format[localize "STR_WL_Warning_TookMoney",name _0of,_0xk];};};case wgoxbf:{_0yi globalChat format[localize "STR_WL_Warning_FriendlyFire",name _0rk];};default{diag_log format["WASTELAND ERROR :: showEventMessage :: UNKNOWN EVENT %1 (%2)",_0qk,_0rk];};};};wght7s={daytime<4.5||daytime>19.5};wgzr5u={call wght7s};wgsjnn={wgfday=0;wgpzrn=0;wgf2lh="";wgc1jm=objNull;wghzcl=objNull;wgyc9j=0;wgzdql=[];wgnkqc=[];wgdgah=[];wgwp71=[];wgshie=false;wg2l11=false;wgtxxr=0;wg7hux=0;wg75pi=objNull;wgwudv=[];wg4pje=[];wgo4au=false;wgew6r=0;wgdzc2=wgc2bp;wgi8h4=diag_tickTime;wgz6fk=0;wgd3pl=0;wg319h=false;wglpbk=0;wg2pbn=nil;wg5hq5=diag_tickTime;wgp5dg=0;wgit2h=0;wgisqm=0;wg74xq=[];wgjlqa=0;wglp4s=0;wgrk8z=0;wg1dnh=objNull;wgkus9=0;wgdl9l=false;if(isNil{wgc292})then{wgc292=[];};call wg1zmx;call wgjp56;_0a=[[],{false},{call wgjl35},{},{}]execFSM "dll.fsm";};wgjl35={if(!wg319h)then{_0yk=(if(isServer)then{52}else{53});if(getClientState=="BRIEFING SHOWN")then{if(!isNull(findDisplay _0yk))then{ctrlActivate((findDisplay _0yk)displayCtrl 1);wg319h=true;};};if(getClientState=="BRIEFING READ")then{wg319h=true;};};for "_i" from 0 to count(wgwudv)-1 do{if(isNil{wg4pje select _i})then{wg4pje set[_i,diag_tickTime];};if(diag_tickTime>=(wg4pje select _i))then{(wgwudv select _i select 1)call(wgwudv select _i select 0);wg4pje set[_i,diag_tickTime+(wgwudv select _i select 2)];};};if(!isNil{wgjzsn})then{call wgjiwf;call wglzgr;};if(!isNil{wgigc3})then{call wgigc3;};if(!isNil{wgvcg7})then{call wgvcg7;};if(commandingMenu=="#WATCH")then{showCommandingMenu "";};if(getPlayerChannel player==0)then{setCurrentChannel 5;};if(wgshie)then{wgshie=false;if(wghzcl!=player)then{_0zk=isEngineOn wghzcl;moveOut player;if(local wghzcl)then{wghzcl engineOn _0zk;};};};if(true)then{_01k=(getFatigue player-wgfday);wgfday=getFatigue player;if(_01k<0)then{_0ej=wgfday+(_01k*3);wgfday=_0ej;player setFatigue _0ej;};};if(diag_tickTime>wglpbk&&vehicle player==player)then{wglpbk=diag_tickTime+3;_09a=nearestObjects[player,["All"],10];{if((player knowsAbout _x)==0)then{player reveal[_x,4];};}forEach _09a;};if(wgi6wo)then{if(!isNull(findDisplay 129))then{(findDisplay 129)displayAddEventHandler["KeyDown",{_02k=false;if((_this select 1)in(actionKeys "NightVision"))then{if(vehicle player!=player)then{}else{if(settings_noWeaponTWS)then{if(cameraView=="GUNNER")then{_0k={_x=="Ti"}count(getArray((configFile>>"CfgWeapons">>(currentWeapon player)>>"OpticsModes")select 0>>"visionmode")+getArray(configFile>>"CfgWeapons">>(currentWeapon player)>>"visionmode"));_02k=_0k>0;};};};};_02k}];wgi6wo=false;};};if(!isNull((vehicle player)getVariable["R3F_LOG_heliporte",objNull]))then{if(driver(vehicle player)==player)then{_03k=(vehicle player)getVariable["R3F_LOG_heliporte",objNull];if(getText(configFile>>"CfgVehicles">>typeOf _03k>>"vehicleclass")=="Support")then{(vehicle player)action["Refuel",_03k];}};};if(animationState player!=wgf2lh)then{wgf2lh=animationState player;switch(getText(configFile>>"CfgMovesMaleSdr">>"States">>wgf2lh>>"actions"))do{case "ParachuteFreeFall":{if(!wg2l11)then{if(wgc1jm isKindOf "Air")then{_0hf=getPosATL player;_0if=getPosATL wgc1jm;_04k=((_0hf select 0)-(_0if select 0))atan2((_0hf select 1)-(_0if select 1));_05k=5;_06k=velocity player;player setVelocity[(_06k select 0)+_05k*(sin _04k),(_06k select 1)+_05k*(cos _04k),(_06k select 2)-1];};wg2l11=true;wgtxxr=diag_tickTime;};};default{wg2l11=false;};};};if(wg2l11&&(diag_tickTime>(wgtxxr+2))&&alive player&&(player distance wgc1jm)>6)then{_07k=(if(surfaceIsWater(getPosATL player))then{getPosASL player}else{getPosATL player})select 2;if(_07k<150+abs(velocity vehicle player select 2))then{wg2l11=false;_08k=createVehicle["Steerable_Parachute_F",getPosATL player,[],0,""];_08k setPosATL getPosATL player;_08k setDir getDir player;[_08k,-90,0]call BIS_fnc_setPitchBank;wg7hux=(velocity player)select 2;wg75pi=_08k;player moveInDriver _08k;};};if(wg7hux<0)then{wg7hux=wg7hux+0.4;_06k=velocity wg75pi;_06k set[2,wg7hux];wg75pi setVelocity _06k;if(wg7hux>-2)then{wg7hux=0;};};if(vehicle player!=wghzcl)then{wgc1jm=wghzcl;wghzcl=vehicle player;wgzdql=(if(wghzcl==player)then{[]}else{wghzcl call wgzez7;});wgnkqc=wghzcl call wgzact;wgdgah=wghzcl call wgpbao;wgwp71=[];wgfazp=[];wg95zb=diag_tickTime;if(isNil{wghzcl getVariable "ws_rolesarray"})then{wg9pbt=wghzcl call wgdeci;wghzcl setVariable["ws_rolesarray",wg9pbt];}else{wg9pbt=wghzcl getVariable "ws_rolesarray";};if(wgc1jm isKindOf "Air")then{wgyc9j=diag_tickTime+1;};if((wghzcl!=player)&&!isNull(wgcnta))then{call wguxaj;};wgkus9=fuel wghzcl;wgdl9l=(wghzcl isKindOf "Plane");_09k=false;if(wghzcl in wgc292)then{if(({if(getFuelCargo _x>0)then{if(_x distance wghzcl<15)then{true};};}count(vehicles)>0)||fuel(wghzcl)>0)then{wg4orn=wghzcl;publicVariableServer "wg4orn";}else{moveOut player;hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2.",localize "STR_WL_Gen_Warning",localize "STR_WL_HUD_ForbiddenEntry"];_09k=true;};};switch(true)do{case!(wghzcl call wgbqap):{_03h=wghzcl getVariable["owner_side",sideUnknown];if(_03h==side group player&&_03h!=independent)then{_0se=wghzcl call wg4ojh;_0al=_0se find true;if(switch(true)do{case(_0al<=0):{true};case(_0al>0&&wgdgah select(_0se find true)):{false};default{true};})then{hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2.",localize "STR_WL_Gen_Warning",format[localize "STR_WL_HUD_CannotGetIntoLocked",name(wghzcl call wgdtln)]];moveOut player;_09k=true;};}else{hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2",localize "STR_WL_Gen_Warning",localize "STR_WL_HUD_CannotGetIntoEnemyLockedVehicle"];moveOut player;_09k=true;};};case!((crew wghzcl)call wg49qh):{hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2",localize "STR_WL_Gen_Warning",localize "STR_WL_HUD_CannotGetIntoEnemyVehicle"];moveOut player;_09k=true;};default{if(wghzcl getVariable["owner_state",wgbbxw]==wghw4q)then{wghzcl setVariable["owner_state",wg9qow,true];};};};if(!_09k)then{_03h=wghzcl getVariable["owner_side",sideUnknown];_0bl=wghzcl getVariable["actual_side",_03h];_0cl=side group player;if(_03h!=sideUnknown&&_0bl!=_0cl)then{wghzcl setVariable["actual_side",_0cl,true];};};};_0dl=false;_0se=wghzcl call wg4ojh;if!(_0se isEqualTo wgwp71)then{_0dl=true;if(side group player!=independent)then{if!(wghzcl call wgbqap)then{if(_0se find true>0)then{if!(wgdgah select(_0se find true))then{moveOut player;hint parseText format["<t size='2' color='#ff0000'>%1</t><br/><br/>%2.",localize "STR_WL_Gen_Warning",format[localize "STR_WL_HUD_CannotGetIntoLocked",name(wghzcl call wgdtln)]];};};};};wgf6r1=(if(wghzcl==player)then{false}else{_0ma=false;{if(_x)exitWith{_0ma=!(wgnkqc select _forEachIndex);};}forEach _0se;_0ma});};wgwp71=_0se;_07i=wghzcl call wgwltp;if(!_0dl)then{_0dl=!([_07i,wgfazp]call wgqz4f);};wgfazp=_07i;if(_0dl)then{call wg7axi;};if(alive player&&!wggw5j&&!wg14a5)then{if(!isNil{wg2pbn})then{_0el=([(getPosASLVisual vehicle player)select 0,(getPosASLVisual vehicle player)select 1,0]vectorDistance[wg2pbn select 0,wg2pbn select 1,0])/(diag_tickTime-wg5hq5);if(_0el>50)then{if(diag_tickTime>wgit2h+1)then{if(vehicle player==player)then{if((diag_tickTime<wgp5dg+1)||(_0el>600))then{_0el call wg56fc;wgit2h=diag_tickTime;wgp5dg=diag_tickTime;}else{wgp5dg=diag_tickTime;};}else{if(_0el>200)then{if(!((vehicle player)isKindOf "Plane")||_0el>800)then{if((local vehicle player)||{isPlayer _x&&alive _x}count(crew vehicle player)==1)then{_0el call wg56fc;wgit2h=diag_tickTime;wgp5dg=diag_tickTime;};};};};};};};wg5hq5=diag_tickTime;wg2pbn=getPosASLVisual vehicle player;}else{wg2pbn=nil;};if(wgisqm>0)then{if(diag_tickTime>wgisqm&&diag_tickTime<wgisqm+10)then{if({_x=="FirstAidKit"}count(items player)==(wgjlqa-1))then{_0fl=(wg74xq select 0);_0fl setDamage 0;wgisqm=0;};}else{wgisqm=0;};};if(diag_tickTime>wglp4s)then{if(vehicle player==player)then{if(speed player==0)then{if(alive player)then{if(wgrk8z!=(getPosASL player)select 0)then{wgrk8z=(getPosASL player)select 0;wglp4s=diag_tickTime+10;player setPosWorld getPosWorld player;};};};};if(diag_tickTime>wglp4s)then{wglp4s=diag_tickTime+1;};};wgk16u=0;if(!isNull(wg1dnh))then{_0d=wg1dnh getVariable["repairkit_available_at",0];if(_0d<serverTime)then{if(call wgx4to)then{wg1dnh setVariable["repairkit_available_at",serverTime+300];wg6xj9=false;wgrfxt=objNull;};}else{hint localize "STR_WL_Dlg_PlayerMenu_MessageRepairKitAlreadyTaken";};wg1dnh=objNull;};if(wgdl9l)then{if((fuel wghzcl)>0)then{if(damage wghzcl>0.2)then{_0ai=(fuel wghzcl)-wgkus9;if(_0ai<0)then{_0ai=_0ai*(damage wghzcl)*100;wghzcl setFuel((wgkus9+_0ai)max 0);};};};wgkus9=fuel wghzcl;};};wg56fc={if(!isNull(wgcty8))then{if(getText(configFile>>"CfgMovesMaleSdr">>"States">>(animationState player)>>"actions")in["LadderRifleActions","LadderCivilActions"])then{player action["LadderOff",wgcty8];wgcty8=objNull;};};wgj7uk=[player,vehicle player,local vehicle player,getPlayerUID player,wg2pbn,(getPosASLVisual vehicle player),(wg2pbn select 2)-(getTerrainHeightASL wg2pbn),((getPosASLVisual vehicle player)select 2)-(getTerrainHeightASL(getPosASLVisual vehicle player)),({if(wg2pbn in _x)exitWith{1}}count wgciid>0),({if((getPosASLVisual vehicle player)in _x)exitWith{1}}count wgciid>0),{if(_x getVariable["object_locked",false]&&(_x getVariable["owner_side",civilian]==side group player)&&(player distance _x)<200)exitWith{1};}count wgcug3==1,_this,(getPosASLVisual vehicle player)vectorDistance wg2pbn,([(getPosASLVisual vehicle player)select 0,(getPosASLVisual vehicle player)select 1,0]vectorDistance[wg2pbn select 0,wg2pbn select 1,0]),0];publicVariableServer "wgj7uk";};wgzact={private["_0fa","_0i"];_0fa=configFile>>"CfgVehicles">>typeOf(_this);_0i=[getNumber(_0fa>>"cargocaneject")==1,getNumber(_0fa>>"drivercaneject")==1];private["_0ad"];_0ad=_0fa>>"turrets";for "_i" from 0 to(count _0ad-1)do{private["_0qi","_0ri"];_0qi=_0ad select _i;_0ri=_0qi>>"turrets";_0i set[count _0i,getNumber(_0qi>>"caneject")==1];for "_j" from 0 to(count _0ri-1)do{private["_0si"];_0si=_0ri select _j;_0i set[count _0i,getNumber(_0si>>"caneject")==1];};};_0i};wgpbao={private["_0fa","_0i"];_0fa=configFile>>"CfgVehicles">>typeOf(_this);_0i=[false,false];private["_0ad"];_0ad=_0fa>>"turrets";for "_i" from 0 to(count _0ad-1)do{private["_0qi","_0ri"];_0qi=_0ad select _i;_0ri=_0qi>>"turrets";_0i set[count _0i,getNumber(_0qi>>"isPersonTurret")==1];for "_j" from 0 to(count _0ri-1)do{private["_0si"];_0si=_0ri select _j;_0i set[count _0i,getNumber(_0si>>"isPersonTurret")==1];};};_0i};wgdeci={private["_0i","_0hl"];_0i=[0,1];private["_0ad","_0gl"];_0ad=configFile>>"CfgVehicles">>typeOf(_this)>>"turrets";_0gl=_this isKindOf "Air";for "_i" from 0 to(count _0ad-1)do{private["_0qi","_0ri"];_0qi=_0ad select _i;_0ri=_0qi>>"turrets";switch(true)do{case(getNumber(_0qi>>"iscopilot")==1&&_0gl):{_0i set[count _0i,4];};case(getNumber(_0qi>>"primaryobserver")==1):{_0i set[count _0i,3];};default{_0i set[count _0i,2];};};for "_j" from 0 to(count _0ri-1)do{private["_0si"];_0si=_0ri select _j;switch(true)do{case(getNumber(_0si>>"iscopilot")==1&&_0gl):{_0i set[count _0i,4];};case(getNumber(_0si>>"primaryobserver")==1):{_0i set[count _0i,3];};default{_0i set[count _0i,2];};};};};_0i};wgzez7={private["_0ad","_0pi"];_0ad=configFile>>"CfgVehicles">>typeOf(_this)>>"turrets";_0pi=[];for "_i" from 0 to(count _0ad-1)do{private["_0qi","_0ri"];_0qi=_0ad select _i;_0ri=_0qi>>"turrets";_0pi=_0pi+[[_i]];for "_j" from 0 to(count _0ri-1)do{private["_0si"];_0si=_0ri select _j;_0pi=_0pi+[[_i,_j]];};};_0pi};wgwltp={private["_0hl","_0i","_0il","_0jl"];_0hl=[];{_0hl set[count _0hl,_this turretUnit _x];}forEach wgzdql;_0il=driver _this;_0jl=[];{if(alive _x)then{_0jl set[count _0jl,_x];};}forEach((crew _this)-[_0il]-_0hl);if(!alive _0il)then{_0il=objNull;};_0i=[_0jl,_0il];{_0i set[count _0i,(if(alive _x)then{_x}else{objNull})];}forEach _0hl;_0i};wgqz4f={private["_0kl","_0ll","_0i"];_0kl=_this select 0;_0ll=_this select 1;if(count(_0kl)!=count(_0ll))exitWith{false};if(count(_0kl select 0)!=count(_0ll select 0))exitWith{false};_0i=(for "_i" from 1 to count(_0kl)-1 do{if(isNull(_0kl select _i)&&!isNull(_0ll select _i))exitWith{false};if(!isNull(_0kl select _i)&&isNull(_0ll select _i))exitWith{false};if(!isNull(_0kl select _i)&&!isNull(_0ll select _i)&&(_0kl select _i)!=(_0ll select _i))exitWith{false};});if(isNil{_0i})then{_0i=true;};_0i};wg4ojh={private["_0hl","_0i"];_0hl=[];{_0hl set[count _0hl,_this turretUnit _x==player];}forEach wgzdql;_0i=[(count _0hl=={!_x}count _0hl)&&(driver _this!=player),driver _this==player];{_0i set[count _0i,_x];}forEach _0hl;_0i};wgmaar={private["_0kl","_0ll","_0i"];_0kl=_this select 0;_0ll=_this select 1;if(count(_0kl)!=count(_0ll))exitWith{false};_0i=true;for "_i" from 0 to count(_0kl)-1 do{if(((_0kl select _i)&&!(_0ll select _i))||(!(_0kl select _i)&&(_0ll select _i)))exitWith{_0i=false;};};_0i};wgawn4=[[],[]];wg92gr={if((wgawn4 select 0)find _this>=0)exitWith{(wgawn4 select 1)select((wgawn4 select 0)find _this);}:private["_0fa","_0ml"];_0fa=(configFile>>"CfgMagazines");_0ml="";for "_i" from 0 to count(_0fa)-1 do{if(getText((_0fa select _i)>>"ammo")==_this)exitWith{_0ml=configName(_0fa select _i);};};if((wgawn4 select 1)find _0ml==-1)then{(wgawn4 select 0)pushBack _this;(wgawn4 select 1)pushBack _0ml;};_0ml};wgegkd={if(_this)then{_this=1}else{_this=-1};player addRating(100000*_this-(rating player));};wgc61g={private["_05j","_m","_0da","_05d","_0ol","_0nl"];_05d="";_05j=floor(_this/3600);_m=floor((_this%3600)/60);_0da=floor(_this%60);_0nl=(if(_0da<10)then{format["0%1",_0da]}else{_0da});_0ol=(if(_m<10)then{format["0%1",_m]}else{_m});if(_05j>0)then{_05d=format["%1:%2:%3",_05j,_0ol,_0nl];}else{_05d=format["%1:%2",_0ol,_0nl];};_05d};wgri6x={switch(_this)do{case blufor:{"A3\ui_f\data\map\diary\icons\playerWest_ca.paa"};case opfor:{"A3\ui_f\data\map\diary\icons\playerEast_ca.paa"};case independent:{"A3\ui_f\data\map\diary\icons\playerGuer_ca.paa"};default{"A3\ui_f\data\map\diary\icons\playerCiv_ca.paa"};};};wgo3qw={if(_this select 0==_this select 1)exitWith{true};_0i=false;_0j=(if(isNil{_this select 2})then{"CfgWeapons"}else{_this select 2});_0k=configFile>>_0j>>(_this select 0);for "_i" from 0 to 4 do{if(!isNil{_0k})then{_0k=inheritsFrom(_0k);if(configName(_0k)==_this select 1)exitWith{_0i=true;};};};_0i};wgd52q={_pos=(switch(typeName(_this))do{case(typeName objNull):{player reveal[_this,4];_pos=getPosATL _this;_0g=boundingBox _this;_pos set[0,(_pos select 0)+(_0g select 1 select 1)];_pos};case(typeName[]):{_this};default{nil};});if(isNil{_pos})exitWith{systemChat "Cannot TP, bad parameter";};_pos spawn{_this call wgsnl2;player setPosATL _this;};};wg6b2n={if(isServer)exitWith{};while{true}do{_pos=getPosATL player;_0ge=diag_tickTime+2;waitUntil{sleep 0.5;(diag_tickTime>_0ge)||((positionCameraToWorld[0,0,0])distance _pos)>300};_0pl=(positionCameraToWorld[0,0,0]);{private["_0ea","_0ca"];_0ca=_x;_0da=!(!(local _0ca)&&count(crew _0ca)==0&&(_0pl distance _0ca)>60&&_0ca!=cursorTarget&&[0,0,0]distanceSqr(velocity _0ca)<10&&(_0ca getVariable["damage_change_at",0]<(diag_tickTime-30))&&(_0ca getVariable["last_alive_at",0]<(diag_tickTime-30)));_0ea=_0ca getVariable["last_damage",-1];if(isNil{_0ea})then{_0ea=-1;};if(_0ea!=damage _0ca)then{_0ca setVariable["last_damage",damage _0ca];if(_0ea!=-1)then{_0ca setVariable["damage_change_at",diag_tickTime];_0da=true;};};if(!alive _0ca&&isNil{_0ca getVariable "last_alive_at"})then{_0ca setVariable["last_alive_at",diag_tickTime];};if(!(missionNamespace getVariable["publicVar_simulationOptimization",true]))then{_0da=true;};if((_0da&&!(simulationEnabled _0ca))||(!_0da&&(simulationEnabled _0ca)))then{_0ca enableSimulation _0da;};}forEach((entities "Air")+(entities "LandVehicle")+(entities "Ship"));};};wgsapy={_0i=false;{if((_x distance(_this select 0))<(_this select 1))exitWith{_0i=true;};}forEach playableUnits;_0i};wgvdho={{(_x distance(_this select 0))<(_this select 1)}count playableUnits};wg15vh={createDialog "Wasteland_Teamkilled";disableSerialization;private["_0jk"];_0jk=uiNamespace getVariable "Wasteland_Teamkilled";[_0jk,""]call bis_fnc_guiEffectTiles;(_0jk displayCtrl wg7miq)ctrlSetText wg4sje;(_0jk displayCtrl wg7miq)ctrlShow!isStreamFriendlyUIEnabled;(_0jk displayCtrl wg1x8v)ctrlSetStructuredText parseText(format[localize "STR_WL_Dlg_Teamkilled_Text",format["<t color=""#aaaaaa"">%1</t>",wgiyr9 select 0],localize format["STR_WL_Dlg_Teamkilled_Type%1",wgiyr9 select 2],localize format["STR_WL_Gen_Team%1_2",str(side player)]]);};wgh569={disableSerialization;private["_0jk"];_0jk=uiNamespace getVariable "Wasteland_Teamkilled";_0bj=ctrlText(_0jk displayCtrl wgcbqr);closeDialog 0;if(wgiyr9 select 1=="")exitWith{};if(_this)then{_uid=wgiyr9 select 1;_0ql=false;for "_i" from 0 to(count wgspzs-1)do{if((wgspzs select _i select 0)==_uid)exitWith{wgspzs set[_i,[_uid,(wgspzs select _i select 1)+1]];_0ql=true;};};if(!_0ql)then{wgspzs set[count wgspzs,[_uid,1]];};publicVariable "wgspzs";};wge2fk=[wgiyr9 select 4,_this,toArray(_0bj)];publicVariableServer "wge2fk";};wgleln={_0ad=configFile>>"CfgVehicles">>(typeOf _this)>>"turrets";((count _0ad)>0)};wgp58v={_0ze=_this select 0;_0li=_this select 1;if(!local _0ze)exitwith{};_08i=objNull;_0oi="";if((_0ze!=_0li)&&(vehicle _0ze!=vehicle _0li)&&(playerSide==side _0li)&&(playerSide in[blufor,opfor]))then{if(_0li isKindOf "Man")then{_08i=_0li;_0oi=(if(vehicle _0li!=_0li)then{"ROADKILL"}else{"SHOT"});}else{_0ca=(_0li);_0ad=configFile>>"CfgVehicles">>typeof _0ca>>"turrets";_0pi=[[-1]];if(count _0ad>0)then{for "_i" from 0 to(count _0ad-1)do{_0qi=_0ad select _i;_0ri=_0qi>>"turrets";_0pi=_0pi+[[_i]];for "_j" from 0 to(count _0ri-1)do{_0si=_0ri select _j;_0pi=_0pi+[[_i,_j]];};};};_0ti=wgxy8w;_0ui=[];{_0dd=(_0ca weaponsTurret _x)-_0ti;if(count _0dd>0)then{_0vi=objNull;if(_x select 0==-1)then{_0vi=driver _0ca;}else{_0vi=_0ca turretUnit _x;};if(!isNull _0vi)then{_0ui=_0ui+[_0vi];};};}forEach _0pi;if(count _0ui==1)then{_08i=_0ui select 0;_0oi="VEHICLE";};};};if(!isNull(_08i))then{wgd6yc=_08i;publicVariable "wgd6yc";_0ac=[];for "_i" from 1 to 16 do{_0bc=48+(floor random(9));_0ac=_0ac+[_0bc];};_0qa=format["TK_%1",toString _0ac];wg77pp=[_08i,player,_0oi,_0qa];publicVariableServer "wg77pp";wgfypi=[name _08i,getPlayerUID(_08i),_0oi,_08i,_0qa];};};wgn15n={true spawn{disableSerialization;private["_0jk","_0rl"];_0jk=uiNamespace getVariable "Wasteland_RespawnIn";_0rl=_0jk displayCtrl wgm6mm;while{(wghh75-serverTime)>=0}do{if(isNil{if(isNull(_0jk))then{nil}else{true}})exitWith{};_0rl ctrlSetText format["%1 %2%3",localize "STR_WL_Gen_RespawnInUppercase",ceil(wghh75-serverTime)max 0,"_"];};};private["_07a","_0sl"];_07a=[];for "_i" from 0 to count(wglil3)-1 do{if(call(wglil3 select _i select 0)&&_i!=wgxjkk)then{for "_j" from 1 to(wglil3 select _i select 1)do{_07a set[count _07a,_i];};};};wgxjkk=(_07a select floor(random(count _07a)));_0sl=wglil3 select wgxjkk;disableSerialization;private["_0jk","_0ul","_0tl"];_0jk=uiNamespace getVariable "Wasteland_RespawnIn";_0tl=_0jk displayCtrl wg1pj7;_0ul=_0jk displayCtrl wgy89h;if(isNil{if(isNull(_0jk))then{nil}else{true}})exitWith{};_0tl ctrlSetText(_0sl select 2);_0ul ctrlSetStructuredText parseText format["<t size='2'>%1</t><br/>%2",_0sl select 3,_0sl select 4];};wgxjkk=-1;wglil3=[[{true},10,"i\hintraregear.paa",localize "STR_WL_Hint_RareGear",localize "STR_WL_Hint_RareGearText"],[{true},10,"i\hintloot.paa",localize "STR_WL_Hint_LootInBuildings",localize "STR_WL_Hint_LootInBuildingsText"],[{true},10,"i\hintregen.paa",localize "STR_WL_Hint_HealthRegeneration",format[localize "STR_WL_Hint_HealthRegenerationText",wg6cum,"%"]],[{true},10,"i\hintnames.paa",localize "STR_WL_Hint_PlayerNames",localize "STR_WL_Hint_PlayerNamesText"],[{true},10,"i\hintparachute.paa",localize "STR_WL_Hint_Parachuting",localize "STR_WL_Hint_ParachutingText"],[{true},10,"i\hintsalvage.paa",localize "STR_WL_Hint_Salvaging",localize "STR_WL_Hint_SalvagingText"],[{true},1000,"i\hintgestures.paa",localize "STR_WL_Hint_Gestures",localize "STR_WL_Hint_GesturesText"],[{true},10,"i\hintrespawnable.paa",localize "STR_WL_Hint_Respawnable",localize "STR_WL_Hint_RespawnableText"]];wg4wm3={private["_0dj","_0zb","_0o","_0p","_0q","_03","_04","_05","_0s","_0af","_0v","_0y","_0t","_0vl","_0xl","_0u","_0wl","_0yl"];_0dj=_this;player switchMove "amovppnemstpsnonwnondnon";_0zb=magazinesAmmoFull _0dj;_0o=weapons _0dj;_0p=assignedItems _0dj;_0q=items _0dj;_03=uniform _0dj;_04=vest _0dj;_05=backpack _0dj;_0s=headgear _0dj;_0af=goggles _0dj;_0t=_0dj getVariable["revive_primary",[]];_0vl=_0dj getVariable["revive_primary_wh",objNull];_0u=_0dj getVariable["revive_secondary",[]];_0wl=_0dj getVariable["revive_secondary_wh",objNull];_0v=handgunWeapon _0dj;_0y=handgunItems _0dj;_0q=_0q-_0o-[_0v];_0o=_0o-[_0v];{player removeWeapon _x}forEach(assignedItems player);removeUniform player;removeVest player;removeBackpack player;removeAllWeapons player;removeHeadgear player;removeGoggles player;if(_03!="")then{removeUniform player;player forceAddUniform _03;};if(_04!="")then{player addVest _04;};if(_05!="")then{player addBackpack _05;clearWeaponCargoGlobal(unitBackpack player);clearMagazineCargoGlobal(unitBackpack player);clearItemCargoGlobal(unitBackpack player);};if(_0af!="")then{player addGoggles _0af};if(_0s!="")then{player addHeadgear _0s};if(!isNull(_0vl))then{_0xl=weaponCargo(_0vl);if(isNil{_0xl})then{_0xl=[];};if((_0dj==_0vl)||((_0t select 0)in _0xl))then{if(_0t select 2!="")then{player addMagazine[_0t select 2,_0t select 3];};player addWeapon(_0t select 0);{player removePrimaryWeaponItem _x}forEach(primaryWeaponItems player);{if(_x!="")then{player addPrimaryWeaponItem _x}}forEach(_0t select 1);if(_0dj!=_0vl)then{deleteVehicle _0vl;};};};if(!isNull(_0wl))then{_0yl=weaponCargo(_0wl);if(isNil{_0yl})then{_0yl=[];};if((_0dj==_0wl)||((_0u select 0)in _0yl))then{if(_0u select 2!="")then{player addMagazine[_0u select 2,_0u select 3];};player addWeapon(_0u select 0);{if(_x!="")then{player addSecondaryWeaponItem _x}}forEach(_0u select 1);if(_0dj!=_0wl)then{deleteVehicle _0wl;};};};if(_0v!="")then{player addWeapon _0v;{player removeHandgunItem _x}forEach(handgunItems player);{if(_x!="")then{player addHandgunItem _x}}forEach _0y;};{player addMagazine[_x select 0,_x select 1]}forEach _0zb;{player addItem _x}forEach _0q;{player addWeapon _x}forEach _0p;{(unitBackpack player)addWeaponCargoGlobal[_x,1];}forEach _0o;_0fd={if(_0dj in crew _x)exitWith{_x}}forEach vehicles;if(isNil{_0fd})then{_0fd=objNull};if(!isNull(_0fd))then{_0fd deleteVehicleCrew _0dj;if!(player moveInAny _0fd)then{player setPosATL getPosATL _0dj;};}else{player setPosATL getPosATL _0dj;player setDir getDir _0dj;deleteVehicle _0dj;};player setVariable["was_revived",true,true];player setDamage 0.4;call wgnydb;wg14a5=false;call wg3n3u;wglovb=player;if(typeName wgfypi==typeName[])then{wgiyr9=wgfypi;wgfypi=false;true call wg15vh;};player setVariable["ready",true,true];if(!isNil{settings_disableFatigue})then{if(settings_disableFatigue)then{player enableFatigue false;}};};wgwk8n={wg14a5=false;wgynfh=wg3re5;publicVariableServer "wgynfh";wg3re5 setVariable["revive_player",objNull,true];wg3re5=objNull;true spawn{if(!isNil{wgiztd})then{wgc9gy=true;wghh75=serverTime+settings_respawnTime;8 cutRsc["Wasteland_RespawnIn","PLAIN",0.00001];call wgn15n;call wgbtw7;true spawn{sleep 1;call wgn9tl;};_05k=1;RscNoise_color=[1,1,1,0.5];4 cutText["","BLACK",_05k];5 cutRsc["RscNoise","PLAIN",0.00001];waitUntil{serverTime>wghh75};8 cutFadeOut 0;wgc9gy=false;};player call wgygnm;player call wgsnbk;call wgmw2n;call wgychn;call wgnydb;};};wgnydb={if(!isNil{wgrzk3})then{true call wgi6na;8 cutFadeOut 0;wgrzk3 cameraEffect["terminate","back"];camDestroy wgrzk3;deleteVehicle wgrzk3;};};wgi1ly={false call wgi6na;private["_0zl"];_0zl=positionCameraToWorld[0,0,0];_0zl set[2,(_0zl select 2)+1];call wgnydb;showCinemaBorder true;wgrzk3="camera" createVehicleLocal _0zl;wgrzk3 setPos _0zl;wgrzk3 camSetTarget _this;wgrzk3 camCommit 0;wgrzk3 cameraEffect["internal","back"];8 cutRsc["Wasteland_ReviveStuff","PLAIN",0.00001];_this spawn{sleep 1;private["_0ge"];_0ge=time+30;waitUntil{([0,0,0]distance(velocity _this)==0)||time>_0ge};sleep 1;if(!wg14a5)exitWith{};private["_02l","_01l"];_01l=_this modelToWorld(_this selectionPosition "neck");_02l=+_01l;_02l set[0,(_02l select 0)+0.1];_02l set[1,(_02l select 1)+0.1];_02l set[2,(_02l select 2)+1.5];wgrzk3 camSetPos _02l;wgrzk3 camSetTarget _01l;wgrzk3 camCommit 2;};_this spawn{waitUntil{floor(((_this selectionPosition "pelvis")select 2)*100000)==11996||isNull(_this)};if(isNull(_this))exitWith{};_this switchMove "Static_Dead";_this setPosATL getPosATL _this;if(((getPosATL _this)select 2)<0.1)then{sleep 1;_this setVectorUp(surfaceNormal(getPosATL _this));};};disableSerialization;private["_0jk","_03l"];_0jk=uiNamespace getVariable "Wasteland_ReviveStuff";_03l=_0jk displayCtrl wgalb7;_03l ctrlAddEventHandler["Draw",{[_this,false]call wgg3i1}];_03l ctrlMapAnimAdd[0,0.04,getPosATL _this];ctrlMapAnimCommit _03l;};wgtk3x={if(_this select 1==player)then{wgisqm=diag_tickTime;wg74xq=_this;wgjlqa={_x=="FirstAidKit"}count(items player);};};wgzuan={if(_this==0)exitWith{"0"};private["_0bc","_05d","_04l"];_0bc=_this;_05d="";_04l=(if(_0bc>0)then{""}else{"-"});_0bc=abs(_0bc);while{_0bc>0}do{private["_05l"];_05l=floor(_0bc/10);_05d=str(_0bc-_05l*10)+_05d;_0bc=_05l;};(_04l+_05d)};wg49qh={({if(alive _x&&((side group _x!=side group player)||((side group player)==independent&&(group _x!=group player))))exitWith{1};}count _this)==0};wgr44t={if(side group _this==side group player&&side group _this!=independent)exitWith{true};if(group _this==group player)exitWith{true};false;};wgu2f3={if(!alive _this)exitWith{true};if(side group _this==independent)exitWith{true};if(side group _this!=side group player)exitWith{true};if(group _this==group player)exitWith{true};false;};wgt1xc={private "_0i";_0i="";{_0i=_0i+(if(_forEachIndex==0)then{""}else{", "})+_x;}forEach _this;_0i;};